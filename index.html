<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Favicon - FIXED -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🔥%3C/text%3E%3C/svg%3E">
  <link rel="shortcut icon" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg">
  <link rel="apple-touch-icon" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#bb86fc">
  <link rel="manifest" href="/manifest.json">
  
  <!-- Core SEO Tags -->
  <title>BFF Quiz - Create Friendship Quiz & Challenge Friends</title>
  <meta name="description" content="🔥 Create and share your own friendship quiz! See how well your friends know you with 150+ fun questions. Challenge them now, check the leaderboard, and prove your friendship!">
  <meta name="keywords" content="friendship quiz, bff quiz, quiz game, challenge friends, test friendship, fun questions, social quiz, quiz maker">
  <meta name="author" content="LoopLabs">
  <meta name="robots" content="index, follow">
  <meta name="language" content="English">
  <meta name="revisit-after" content="7 days">
  
  <!-- Google Verification -->
  <meta name="google-site-verification" content="-pmnIIJRNoqHYPsVK-xIEiHRuNVIQd6HjsSIiR7pmLc" />
  
  <!-- Sitemap Reference -->
  <link rel="sitemap" type="application/xml" href="https://bffquiz-five.vercel.app/sitemap.xml" />
  
  <!-- Open Graph / Facebook / WhatsApp Meta Tags - FIXED -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bffquiz-five.vercel.app/">
  <meta property="og:title" content="Friendship Challenge! 🔥 BFF Quiz">
  <meta property="og:description" content="I made a quiz for my friends! Click to play, test our friendship, and see if you can beat the top score on the leaderboard. 🤔">
  <meta property="og:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgCoFt9k93c-M7Ie7ChvzCGRwBbYgZSDXOMQSL7a4XlX3fTU23SNVURs8Ws24bwaxdX8FggWULAjxaxPh_MkMAeJ4hIO_KY3gwHcreeD7KjNjRvOOSFRpXmOqfnQk-oqHsS1ka87LNRhbpwvUweUMtalcQ8ci9s8Xl-E3nUYqEd-jnMcQ4kVcmB-oRgAdE0/s1632/IMG_20251005_222112.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:alt" content="BFF Quiz - Create and share friendship quizzes with friends">
  <meta property="og:site_name" content="BFF Quiz">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Card Meta Tags - FIXED -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://bffquiz-five.vercel.app/">
  <meta property="twitter:title" content="Friendship Challenge! 🔥 BFF Quiz">
  <meta property="twitter:description" content="I made a quiz for my friends! Click to play, test our friendship, and see if you can beat the top score on the leaderboard. 🤔">
  <meta property="twitter:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgCoFt9k93c-M7Ie7ChvzCGRwBbYgZSDXOMQSL7a4XlX3fTU23SNVURs8Ws24bwaxdX8FggWULAjxaxPh_MkMAeJ4hIO_KY3gwHcreeD7KjNjRvOOSFRpXmOqfnQk-oqHsS1ka87LNRhbpwvUweUMtalcQ8ci9s8Xl-E3nUYqEd-jnMcQ4kVcmB-oRgAdE0/s1632/IMG_20251005_222112.jpg">
  <meta property="twitter:creator" content="@looplabstech">
  <meta property="twitter:site" content="@looplabstech">

  <!-- Additional SEO Meta Tags -->
  <meta name="application-name" content="BFF Quiz">
  <meta name="msapplication-TileColor" content="#bb86fc">
  <link rel="canonical" href="https://bffquiz-five.vercel.app/">
  <link rel="alternate" hreflang="en" href="https://bffquiz-five.vercel.app/">
  <link rel="alternate" hreflang="x-default" href="https://bffquiz-five.vercel.app/">

  <!-- Preload Critical Resources -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" as="style">
  <link rel="preload" href="/manifest.json" as="fetch" crossorigin>
  <link rel="preload" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg" as="image">
  
  <!-- DNS Prefetch for External Resources -->
  <link rel="dns-prefetch" href="//jsonblob.com">
  <link rel="dns-prefetch" href="//www.googletagmanager.com">
  <link rel="dns-prefetch" href="//www.highperformanceformat.com">
  
  <!-- Structured Data (Schema Markup) for Rich Snippets -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "BFF Quiz",
    "url": "https://bffquiz-five.vercel.app/",
    "description": "Create and share friendship quizzes with your friends",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://bffquiz-five.vercel.app/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "publisher": {
      "@type": "Organization",
      "name": "LoopLabs",
      "url": "https://bffquiz-five.vercel.app/",
      "logo": {
        "@type": "imageObject",
        "url": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
      }
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [{
      "@type": "Question",
      "name": "How to create a friendship quiz on BFF Quiz?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Simply enter your name, select the number of questions you want, pick your favorite questions from our huge bank, customize the answers, and get a shareable link to challenge your friends!"
      }
    },{
      "@type": "Question",
      "name": "Is this friendship quiz free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, creating and sharing your friendship quiz is completely free. You can see your friends' scores on a live leaderboard."
      }
    },{
      "@type": "Question",
      "name": "How well do my friends know me?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Find out now! Create your personal quiz and share the link on WhatsApp or other social media to test your friends and see who knows you best."
      }
    }]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "BFF Quiz",
    "operatingSystem": "Web",
    "applicationCategory": "GameApplication",
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "1250"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>
  
  <style>
    /* Critical CSS - Inlined for faster loading */
    :root {
      --primary-bg: #0f0f23;
      --secondary-bg: #1a1a3e;
      --card-bg: #252548;
      --border-color: #40407a;
      --primary-accent: #ff6bcb;
      --secondary-accent: #ff9a00;
      --tertiary-accent: #00d9ff;
      --text-color: white;
      --dark-text: #0f0f23;
    }
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { 
      background: var(--primary-bg); 
      color: var(--text-color); 
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container { 
      max-width: 600px; 
      margin: 20px auto; 
      padding: 20px; 
      background: var(--secondary-bg); 
      border-radius: 16px; 
      box-shadow: 0 10px 30px rgba(255, 107, 203, 0.2); 
      position: relative;
      overflow: hidden;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    h1, h2, h3 { 
      text-align: center; 
      color: var(--primary-accent); 
      margin-top: 0; 
      margin-bottom: 20px;
    }
    input[type="text"], select, textarea { 
      width: 100%; 
      padding: 12px; 
      margin: 10px 0; 
      border: 1px solid var(--border-color); 
      border-radius: 8px; 
      background: var(--card-bg); 
      color: var(--text-color); 
      font-size: 1rem;
    }
    button, .social-btn-stacked { 
      padding: 12px; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-weight: bold; 
      font-size: 1rem; 
      color: var(--text-color); 
      width: 100%; 
      margin: 0; 
      text-align: center; 
      text-decoration: none; 
      display: block;
    }
    .btn-purple { 
      background: linear-gradient(to right, var(--primary-accent), var(--secondary-accent)); 
    }
    .main-actions { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 15px; 
      margin: 25px 0; 
    }
    .main-action-btn { 
      display: flex; 
      align-items: center; 
      justify-content: flex-start; 
      gap: 12px; 
      padding: 15px; 
      text-align: left; 
      background: linear-gradient(135deg, var(--primary-accent), var(--secondary-accent)); 
      grid-column: span 1; 
    }
    .main-action-btn.full-width { grid-column: span 2; }
    .main-action-btn svg { width: 28px; height: 28px; flex-shrink: 0; }
    .main-action-btn div { display: flex; flex-direction: column; }
    .main-action-btn span { font-weight: bold; font-size: 1rem; }
    .main-action-btn small { font-size: 0.8rem; opacity: 0.8; font-weight: normal; }
    .question-block { 
      margin-bottom: 20px; 
      padding: 20px; 
      border: 1px solid var(--border-color); 
      border-radius: 12px; 
      background: var(--card-bg);
    }
    .hidden { display: none !important; }
    .question-title { font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
    .option-item { 
      display: flex; 
      align-items: center; 
      padding: 12px; 
      background: var(--border-color); 
      border-radius: 8px; 
      margin-bottom: 10px;
    }
    .option-item input[type="radio"] { margin-right: 15px; flex-shrink: 0; }
    .option-item input[type="text"] { flex-grow: 1; margin: 0; }
    .correct-tick { color: #4caf50; font-weight: bold; margin-left: 10px; font-size: 1.2rem; }
    .question-count-selector { display: flex; justify-content: space-around; gap: 10px; margin-bottom: 20px; }
    .count-btn { width: 100%; margin: 0; }
    .active-count { background: var(--primary-accent); color: var(--dark-text); }
    #socialShareButtons { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
    /* MODAL STYLES - FIXED */
    #questionModal { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: rgba(0,0,0,0.85); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      z-index: 10000; 
      padding: 15px; 
      overflow-y: auto; 
    }
    .modal-content { 
      background: var(--secondary-bg); 
      padding: 20px; 
      border-radius: 12px; 
      width: 100%; 
      max-width: 550px; 
      display: flex; 
      flex-direction: column; 
      max-height: 90vh; 
      box-shadow: 0 20px 60px rgba(255, 107, 203, 0.4); 
      border: 1px solid var(--border-color);
    }
    .modal-body { 
      overflow-y: auto; 
      margin-bottom: 15px; 
      border-top: 1px solid var(--border-color); 
      border-bottom: 1px solid var(--border-color); 
      padding: 15px 0; 
      max-height: 60vh; 
    }
    .modal-question-item { 
      display: flex; 
      align-items: center; 
      padding: 10px; 
      margin: 5px 0; 
      border-radius: 8px; 
      cursor: pointer; 
      background: var(--card-bg);
      border: 1px solid var(--border-color);
    }
    .modal-question-item:hover { background: var(--border-color); }
    .modal-question-item input[type="checkbox"] { margin-right: 15px; width: 20px; height: 20px; flex-shrink: 0; }
    .modal-footer { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 10px; 
    }
    /* BUTTON & LAYOUT FIXES */
    #creationControls { display: flex; gap: 15px; margin-top: 20px; }
    #creationControls button { flex: 1; margin: 0; }
    .quiz-history-item { cursor: pointer; padding:12px; margin-bottom: 10px; background: var(--card-bg); border-radius: 8px; }
    .quiz-history-item:hover { background: var(--border-color); }
    #leaderboard { margin-top: 25px; }
    .leaderboard-item { padding:12px; margin-bottom: 8px; background: var(--card-bg); border-radius: 8px; }
    /* FOOTER CREDIT STYLES - FIXED */
    .footer-credit {
      text-align: center;
      margin-top: auto;
      padding: 20px;
      border-top: 1px solid var(--border-color);
      font-size: 1.1rem;
      font-weight: bold;
      color: #ccc;
      width: 100%;
      background: var(--secondary-bg);
      border-radius: 0 0 16px 16px;
      position: relative;
      z-index: 10;
      flex-shrink: 0;
    }
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      margin-bottom: 10px;
    }
    .footer-links a {
      color: var(--primary-accent);
      text-decoration: none;
      font-weight: 500;
    }
    /* AD SPACE STYLES - SIMPLIFIED */
    .ad-space { 
      height: auto; 
      min-height: 250px; 
      width: 100%; 
      max-width: 300px; 
      background: var(--card-bg); 
      margin: 20px auto; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      border-radius: 8px; 
      border: 1px solid var(--border-color);
      overflow: hidden;
      position: relative;
      clear: both;
    }

    .ad-space-horizontal {
      min-height: 60px;
      max-width: 468px;
      margin: 15px auto;
    }

    .header-ad {
      width: 100%;
      height: 90px;
      max-height: 90px;
      background: var(--card-bg);
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border-color);
      overflow: hidden;
      position: relative;
    }
    
    .header-ad iframe {
      max-height: 60px !important;
    }

    /* Fix for mobile responsiveness */
    @media (max-width: 768px) {
      .ad-space-horizontal {
        max-width: 100%;
        min-height: 60px;
      }
      
      .header-ad {
        height: auto;
        min-height: 60px;
      }
    }
    /* LOGO STYLES */
    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-accent);
    }
    /* Mobile optimization */
    @media (max-width: 480px) {
      .logo {
        width: 80px;
        height: 80px;
      }
    }

    @media (max-width: 768px) {
      .logo {
        width: 120px;
        height: 120px;
      }
    }

    /* High DPI displays */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .logo {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
      }
    }

    /* WebP support fallback */
    .no-webp .logo {
      /* Fallback styles for browsers without WebP */
    }
    /* INSTAGRAM BUTTON - FIXED POSITION */
    .instagram-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: auto;
      min-width: 180px;
      height: 60px;
      background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      z-index: 999;
      padding: 0 15px;
      text-decoration: none;
      color: white;
      font-weight: bold;
    }
    .instagram-btn-text {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .instagram-btn-handle {
      font-size: 14px;
      font-weight: bold;
    }
    .instagram-btn-action {
      font-size: 12px;
      opacity: 0.9;
    }
    /* INSTALL PROMPT */
    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      max-width: 300px;
      z-index: 999;
      display: none;
    }
    .install-prompt.show {
      display: block;
    }
    .install-prompt h4 {
      margin: 0 0 10px 0;
      color: var(--primary-accent);
    }
    .install-prompt p {
      margin: 0 0 15px 0;
      font-size: 0.9rem;
    }
    .install-prompt button {
      background: var(--primary-accent);
      color: var(--dark-text);
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      width: auto;
      margin-right: 10px;
    }
    .install-prompt .dismiss-btn {
      background: transparent;
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    /* RATING STYLES */
    .rating-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 15px 0;
    }
    .rating-stars {
      display: flex;
      margin-right: 10px;
    }
    .rating-stars .star {
      color: #ffd700;
      font-size: 20px;
      margin-right: 2px;
    }
    .rating-text {
      font-size: 14px;
      color: #ccc;
    }
    .rating-count {
      font-size: 12px;
      color: #aaa;
      margin-left: 5px;
    }
    /* USER REVIEWS */
    .reviews-section {
      margin: 20px 0;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 12px;
    }
    .reviews-title {
      text-align: center;
      margin-bottom: 15px;
      color: var(--primary-accent);
    }
    .review-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    .review-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .review-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .reviewer-name {
      font-weight: bold;
      color: var(--primary-accent);
    }
    .review-date {
      font-size: 12px;
      color: #aaa;
    }
    .review-rating {
      margin-bottom: 5px;
    }
    .review-text {
      font-size: 14px;
      line-height: 1.4;
    }
    /* NOTIFICATION STYLES */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      max-width: 300px;
      z-index: 1001;
      transform: translateX(120%);
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification.error {
      border-color: #f44336;
    }
    .notification-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--primary-accent);
    }
    .notification-message {
      font-size: 14px;
    }
    /* DUMMY PAGE STYLES */
    #dummyPage {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }
    #dummyPage h2 {
      margin-bottom: 20px;
      color: var(--primary-accent);
    }
    #dummyPage p {
      margin-bottom: 30px;
      max-width: 400px;
    }
    #dummyPage .btn-purple {
      max-width: 300px;
    }
    /* HIDDEN PAGE STYLES */
    #hiddenPage {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }
    #hiddenPage h2 {
      margin-bottom: 20px;
      color: var(--primary-accent);
    }
    #hiddenPage p {
      margin-bottom: 30px;
      max-width: 400px;
    }
    #hiddenPage .btn-purple {
      max-width: 300px;
    }
    /* ABOUT PAGE STYLES */
    #aboutPage {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }
    #aboutPage h2 {
      margin-bottom: 20px;
      color: var(--primary-accent);
    }
    #aboutPage p {
      margin-bottom: 20px;
      max-width: 500px;
      line-height: 1.6;
    }
    #aboutPage .contact-info {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      width: 100%;
      max-width: 400px;
    }
    #aboutPage .contact-info h3 {
      margin-top: 0;
      color: var(--secondary-accent);
    }
    #aboutPage .contact-info p {
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    #aboutPage .contact-info a {
      color: var(--primary-accent);
      text-decoration: none;
      font-weight: 500;
    }
    /* RANDOM QUIZ STYLES */
    #randomQuizPage {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }
    #randomQuizPage h2 {
      margin-bottom: 20px;
      color: var(--primary-accent);
    }
    #randomQuizPage p {
      margin-bottom: 30px;
      max-width: 400px;
    }
    #randomQuizPage .btn-purple {
      max-width: 300px;
      margin-bottom: 10px;
    }
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 15px;
      }
      .main-actions {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      .main-action-btn.full-width {
        grid-column: span 1;
      }
      .modal-content {
        margin: 10px;
        max-width: calc(100% - 20px);
      }
      .instagram-btn {
        min-width: 150px;
        height: 50px;
        font-size: 0.9rem;
      }
    }
    /* Accessibility Improvements */
    button:focus, input:focus, select:focus, textarea:focus {
      outline: 2px solid var(--primary-accent);
      outline-offset: 2px;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
    /* Edit Note Style - FIXED */
    .edit-note {
      font-size: 0.9rem;
      color: #e0e0e0;
      text-align: center;
      margin-bottom: 15px;
      padding: 12px 15px;
      background: linear-gradient(135deg, rgba(255, 107, 203, 0.15), rgba(255, 154, 0, 0.15));
      border-radius: 8px;
      border-left: 4px solid var(--primary-accent);
      border-right: 4px solid var(--secondary-accent);
      box-shadow: 0 2px 8px rgba(255, 107, 203, 0.2);
    }
    /* Option Grid Style */
    .option-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 15px 0;
    }
    /* Question Item Style for Modal */
    .question-item {
      display: flex;
      align-items: center;
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      cursor: pointer;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
    }
    .question-item:hover {
      background: var(--border-color);
    }
    .question-item input[type="checkbox"] {
      margin-right: 15px;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }
    .question-item-text {
      flex-grow: 1;
    }
    /* Shuffle Button Style */
    .shuffle-btn {
      background: linear-gradient(135deg, var(--secondary-accent), var(--primary-accent));
      margin-bottom: 10px;
    }
    /* Equal size buttons for modal footer - FIXED */
    .modal-footer button {
      min-height: 50px;
      max-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      font-size: 1rem;
    }
    
    /* Mobile fix for modal */
    @media (max-width: 768px) {
      .modal-content {
        margin: 0;
        max-width: 100%;
        border-radius: 0;
        height: 100%;
        max-height: 100%;
      }
      
      .modal-body {
        max-height: 70vh;
      }
    }
    
    /* FOMO Features Styles */
    .fomo-badge {
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, #ff6bcb, #ff9a00);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 12px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(255, 107, 203, 0.4);
      animation: pulse 2s infinite;
    }
    
    .activity-ticker {
      position: fixed;
      bottom: 100px;
      left: 20px;
      background: rgba(26, 26, 62, 0.95);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 13px;
      max-width: 250px;
      z-index: 1000;
      border-left: 3px solid #ff6bcb;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideInLeft 0.5s ease-out;
    }
    
    .urgency-timer {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #dc2743, #cc2366);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: bold;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(220, 39, 67, 0.4);
    }
    
    .social-proof-popup {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      color: #0f0f23;
      padding: 15px;
      border-radius: 8px;
      max-width: 300px;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      transform: translateY(150%);
      transition: transform 0.5s ease-out;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes slideInLeft {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutLeft {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-100%); opacity: 0; }
    }
  </style>
  
  <!-- Non-Critical CSS - Loaded after initial render -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'">
</head>
<body>

<!-- Home Page (Default) -->
<div id="home" class="container">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Create Friendship Quizzes Online"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <!-- Header Ad Banner - SIMPLIFIED -->
  <div class="header-ad" id="headerAd">
    <!-- Ad will be loaded by JavaScript -->
  </div>
  
  <!-- Second Header Ad Banner -->
  <div class="header-ad" id="headerAd2">
    <!-- Ad will be loaded by JavaScript -->
  </div>
  
  <h1>Create Your Own BFF Friendship Quiz Online - Free Quiz Maker</h1>
  <p style="text-align:center;">Create a friendship quiz & challenge your friends!</p>
  
  <!-- Rating Section -->
  <div class="rating-container">
    <div class="rating-stars">
      <span class="star">★</span>
      <span class="star">★</span>
      <span class="star">★</span>
      <span class="star">★</span>
      <span class="star">★</span>
    </div>
    <div class="rating-text">4.8<span class="rating-count">(1,250 reviews)</span></div>
  </div>
  
  <input type="text" id="userName" placeholder="Apna Naam Yahan Likhein" aria-label="Enter your name" />
  <div class="main-actions">
      <button class="main-action-btn" onclick="showCreate()" aria-label="Create a new quiz">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4v2z"></path></svg>
          <div><span>Create Quiz</span><small>Start a new challenge</small></div>
      </button>
      <button class="main-action-btn" onclick="showCreatorHistory()" aria-label="View created quizzes">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2z"></path></svg>
          <div><span>My Created</span><small>Check your quiz stats</small></div>
      </button>
      <button class="main-action-btn full-width" onclick="showPlayerHistory()" aria-label="View your scores">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-4h2v4zm4 0h-2V7h-2v7zm4 0h-2V7h-2v7zm4 0h-2V7h-2v7z"></path></svg>
          <div><span>My Scores</span><small>Check your past results</small></div>
      </button>
  </div>
  
  <!-- Ad Space (Top) - SIMPLIFIED -->
  <div class="ad-space" id="topAd">
    <!-- Ad will be loaded by JavaScript -->
  </div>
  
  <!-- User Reviews Section - Moved Above Footer -->
  <div class="reviews-section">
    <h3 class="reviews-title">What Users Are Saying</h3>
    <div class="review-item">
      <div class="review-header">
        <span class="reviewer-name">Priya Sharma</span>
        <span class="review-date">2 days ago</span>
      </div>
      <div class="review-rating">
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">★</span>
      </div>
      <div class="review-text">Amazing app! Created a quiz for my friends and we had so much fun. The questions are great and the interface is super easy to use.</div>
    </div>
    <div class="review-item">
      <div class="review-header">
        <span class="reviewer-name">Rahul Verma</span>
        <span class="review-date">1 week ago</span>
      </div>
      <div class="review-rating">
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">★</span>
        <span class="star">☆</span>
      </div>
      <div class="review-text">Love this app! It's become our go-to activity at parties. The leaderboard feature makes it competitive and fun.</div>
    </div>
  </div>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- Create Quiz Page -->
<div id="create" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Design Your Personalized Friendship Quiz"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h2>Design Your Personalized Friendship Quiz - 150+ Questions</h2>
  <div class="question-count-selector">
    <button class="count-btn btn-purple" onclick="setQuestionCount(5)" aria-label="Select 5 questions">5 Qs</button>
    <button class="count-btn btn-purple" onclick="setQuestionCount(10)" aria-label="Select 10 questions">10 Qs</button>
    <button class="count-btn btn-purple" onclick="setQuestionCount(15)" aria-label="Select 15 questions">15 Qs</button>
    <button class="count-btn btn-purple" onclick="setQuestionCount(20)" aria-label="Select 20 questions">20 Qs</button>
  </div>
  <button class="btn-purple" onclick="showQuestionModal()" style="margin-bottom:20px;" aria-label="Select questions from bank">Select Questions from Bank</button>
  <p id="questionCounter" style="text-align: center; margin-bottom: 20px;" aria-live="polite"></p>
  <div id="questionsContainer"><p style="text-align:center; opacity: 0.7;">Your selected questions will appear here for final review.</p></div>
  <div id="creationControls" class="hidden">
      <button class="btn-purple shuffle-btn" onclick="shuffleSelectedQuestions()" aria-label="Shuffle questions">Shuffle Questions</button>
      <button class="btn-purple" onclick="finishAndShareQuiz()" aria-label="Finish and share quiz">Finish & Share Link</button>
  </div>
  
  <!-- Ad Space (Middle) - SIMPLIFIED -->
  <div class="ad-space" id="middleAd">
    <!-- Ad will be loaded by JavaScript -->
  </div>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- Play Quiz Page -->
<div id="play" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Test Your Friendship"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h2 id="quizTitle"></h2>
  <div id="playTakerName">
      <input type="text" id="takerName" placeholder="Apna Naam Yahan Likhein" aria-label="Enter your name" />
      <button class="btn-purple" onclick="startQuiz()" aria-label="Start quiz">Start Quiz</button>
      
      <!-- Ad Slot 1: Below Start Quiz Button - SIMPLIFIED -->
      <div id="startQuizAd" class="ad-space" style="margin-top:20px;">
        <!-- Ad will be loaded by JavaScript -->
      </div>
  </div>
  <div id="quizContentWrapper" class="hidden">
    <div id="quizContent">
      <!-- Questions will be dynamically loaded here -->
    </div>
    
    <!-- Ad Slot 2: Below Next Question Button - SIMPLIFIED -->
    <div id="inQuizAd" class="ad-space hidden" style="margin-top:0;">
      <!-- Ad will be loaded by JavaScript -->
    </div>
  </div>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
  </div>
  </div>
</div>

<!-- Result & Share Page -->
<div id="result" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Quiz Results & Leaderboard"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h2 id="resultTitle"></h2>
  <div id="scoreText"></div>
  <div id="leaderboard" class="hidden">
      <h3>🏆 Leaderboard</h3>
      <div id="leaderboardList">Loading...</div>
  </div>
  <div id="shareBox" class="hidden">
      <h3>Share this Quiz!</h3>
      <p>Challenge your friends to beat your score!</p>
      <div id="shareLink" class="hidden"></div>
      <div id="socialShareButtons">
          <!-- Buttons will be generated by JS here -->
      </div>
  </div>
   
   <!-- Ad Space (Bottom on Result Page / Under Leaderboard) - SIMPLIFIED -->
   <div class="ad-space" id="resultAd">
    <!-- Ad will be loaded by JavaScript -->
   </div>
   
  <button class="btn-purple" onclick="resetAndGoHome()" style="margin-top: 20px;" aria-label="Create your own quiz">Create Your Own Quiz</button>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- CREATOR History Page -->
<div id="creatorHistoryPage" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Your Created Quizzes"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
    <div id="creatorHistoryWrapper">
        <h2>My Created Quizzes</h2>
        <div id="creatorHistoryList"></div>
    </div>
    <div id="creatorLeaderboardView" class="hidden">
        <h3 id="creatorLeaderboardTitle"></h3>
        <p id="creatorPlayerCount" style="text-align:center; font-weight:bold;"></p>
        <div id="creatorLeaderboardList"></div>
        <button class="btn-purple" onclick="showCreatorHistoryList()" style="margin-top:20px;" aria-label="Back to quiz list">Back to Quiz List</button>
    </div>
    
    <!-- Ad Space (Creator History) - SIMPLIFIED -->
    <div class="ad-space" id="creatorHistoryAd">
      <!-- Ad will be loaded by JavaScript -->
    </div>
    
    <button class="btn-purple" onclick="showPage('home')" style="margin-top:20px;" aria-label="Back to home">Back to Home</button>
    
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- PLAYER History Page (My Scores) -->
<div id="playerHistoryPage" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Your Quiz Scores"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h2>My Score History</h2>
  <div id="playerHistoryList"></div>
  
  <!-- Ad Space (Player History) - SIMPLIFIED -->
  <div class="ad-space" id="playerHistoryAd">
    <!-- Ad will be loaded by JavaScript -->
  </div>
  
  <button class="btn-purple" onclick="showPage('home')" style="margin-top:20px;" aria-label="Back to home">Back to Home</button>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- Random Quiz Page -->
<div id="randomQuizPage" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - Random Friendship Questions"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h1>Random Quiz</h1>
  <p style="text-align:center;">Try our randomly generated friendship quiz!</p>
  
  <div id="randomQuiz">
    <div class="question-block">
      <h3 id="randomQuestionText">Loading question...</h3>
      <div id="randomOptions"></div>
    </div>
    
    <button class="btn-purple" onclick="submitRandomQuiz()">Submit Answer</button>
    <button class="btn-purple" onclick="generateNewRandomQuestion()">New Question</button>
    <button class="btn-purple" onclick="showPage('home')">Back to Home</button>
  </div>
  
  <div id="randomResult" class="hidden">
    <h2>Your Answer</h2>
    <p id="randomAnswerText" style="text-align:center; font-size: 1.2rem;"></p>
    <p id="randomExplanation" style="text-align:center; margin: 20px 0;"></p>
    <button class="btn-purple" onclick="generateNewRandomQuestion()">Try Another Question</button>
    <button class="btn-purple" onclick="showPage('home')">Back to Home</button>
  </div>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#home" onclick="showPage('home'); return false;">Home</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- About Page -->
<div id="aboutPage" class="container hidden">
  <!-- Logo - FIXED -->
  <div class="logo-container">
    <picture>
      <!-- WebP for modern browsers -->
      <source 
        srcset="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        type="image/jpeg">
      
      <!-- Final fallback -->
      <img 
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiw7p4ddixu5QjJ3yDAgIvAkrzFGNk2h_KOeDn9TzsljOPRHnPyRSmDZu4VoYPOwi1lr24VikemKzvNUveFGlhB8ersbf3FSCSjYZ7YxMU7d9AuEtMqbUS3exY19hcFQ0SSSJBstOIy3yGUGwKF9i51TSlu677sZuapKQhNGOkFg2J4uF8PoRuau5_YJwRx/s1080/Picsart_25-10-05_22-20-31-071.jpg"
        alt="BFF Quiz - About Us"
        class="logo"
        loading="lazy"
        decoding="async"
        width="120"
        height="120"
        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22%3E🔥%3C/text%3E%3C/svg%3E'"
        style="max-width: 100%; height: auto;">
    </picture>
  </div>
  
  <h1>About BFF Quiz</h1>
  <p>BFF Quiz is a fun and interactive platform that allows you to create personalized friendship quizzes to test how well your friends know you. With our extensive question bank, you can create unique quizzes that reveal interesting aspects of your personality and friendships.</p>
  
  <p>Our mission is to strengthen friendships through fun and engaging challenges. Whether you're at a party, hanging out with friends, or just want to have some fun online, BFF Quiz is the perfect way to connect and create memorable moments.</p>
  
  <div class="contact-info">
    <h3>Contact Us</h3>
    <p>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect>
        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
      </svg>
      <a href="https://www.instagram.com/looplabstech" target="_blank">@looplabstech</a>
    </p>
  </div>
  
  <button class="btn-purple" onclick="showPage('home')">Back to Home</button>
  
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#random-quiz" onclick="showRandomQuiz(); return false;">Random Quiz</a>
      <a href="#home" onclick="showPage('home'); return false;">Home</a>
    </div>
  </div>
</div>

<!-- Dummy Page (Hidden) -->
<div id="dummyPage" class="container hidden">
  <div id="dummyPageContent">
    <h2>This is a Hidden Page</h2>
    <p>This page is not accessible from the main navigation. It's only accessible through direct links and is included in the sitemap for SEO purposes.</p>
    <button class="btn-purple" onclick="showPage('home')" aria-label="Go to home page">Go to Home Page</button>
  </div>
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#home" onclick="showPage('home'); return false;">Home</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- Hidden Page (SEO Only) -->
<div id="hiddenPage" class="container hidden">
  <div id="hiddenPageContent">
    <h2>BFF Quiz - SEO Page</h2>
    <p>This is a hidden page designed specifically for SEO purposes. It helps improve the website's visibility on search engines and ensures better indexing.</p>
    <p>BFF Quiz is a fun and interactive way to test your friendship bonds. Create custom quizzes with our extensive question bank and challenge your friends to see who knows you best!</p>
    <p>Features include:</p>
    <ul style="text-align: left; max-width: 400px;">
      <li>150+ pre-written questions</li>
      <li>Customizable quiz options</li>
      <li>Real-time leaderboards</li>
      <li>Social sharing capabilities</li>
      <li>Mobile-friendly design</li>
    </ul>
    <button class="btn-purple" onclick="showPage('home')" aria-label="Go to home page">Go to Home Page</button>
  </div>
  <!-- Footer -->
  <div class="footer-credit">
    <p>LoopLabs – All Rights Reserved</p>
    <div class="footer-links">
      <a href="#home" onclick="showPage('home'); return false;">Home</a>
      <a href="#about" onclick="showAboutPage(); return false;">About</a>
    </div>
  </div>
</div>

<!-- SEO Page (Hidden from users, visible to search engines) -->
<div id="seoPage" class="container hidden" style="display:none !important; visibility:hidden; position:absolute; left:-9999px; top:-9999px;">
  <div id="seoPageContent">
    <h1>BFF Quiz - The Ultimate Friendship Challenge</h1>
    <p>Discover the most engaging way to test your friendships with BFF Quiz! Our innovative platform allows you to create personalized quizzes with over 150 carefully crafted questions that will reveal how well your friends truly know you.</p>
    
    <h2>Why Choose BFF Quiz?</h2>
    <ul>
      <li>Create custom quizzes in minutes with our intuitive interface</li>
      <li>Choose from our extensive question bank covering various aspects of friendship</li>
      <li>Share quizzes instantly on WhatsApp, Instagram, and other social platforms</li>
      <li>Track scores with real-time leaderboards</li>
      <li>Enjoy a mobile-optimized experience that works seamlessly on all devices</li>
    </ul>
    
    <h2>How It Works</h2>
    <ol>
      <li>Enter your name to get started</li>
      <li>Select the number of questions for your quiz (5, 10, 15, or 20)</li>
      <li>Pick your favorite questions from our comprehensive bank</li>
      <li>Customize answers to make the quiz truly personal</li>
      <li>Share the generated link with your friends</li>
      <li>Watch as they take the quiz and see who knows you best!</li>
    </ol>
    
    <h2>Perfect for Every Occasion</h2>
    <p>BFF Quiz is ideal for:</p>
    <ul>
      <li>Birthday parties and gatherings</li>
      <li>Sleepovers and get-togethers</li>
      <li>Virtual hangouts with friends</li>
      <li>Icebreakers at events</li>
      <li>Just having fun with your closest friends</li>
    </ul>
    
    <h2>Join Thousands of Happy Users</h2>
    <p>With over 1,250 five-star reviews, BFF Quiz has become the go-to app for friendship challenges. Join the community today and discover what makes your friendships special!</p>
    
    <p>Download BFF Quiz now and start creating memorable moments with your friends!</p>
  </div>
</div>

<!-- Question Selection Modal -->
<div id="questionModal" class="container hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Select Your Questions</h3>
      <input type="text" id="questionSearch" onkeyup="renderModalList()" placeholder="Search for questions..." aria-label="Search questions">
      <p id="modalCounter" style="text-align:center; margin: 5px 0;" aria-live="polite"></p>
    </div>
    <div class="modal-body" id="questionList"></div>
    <div class="modal-footer">
      <button class="btn-purple shuffle-btn" onclick="shuffleModalQuestions()" aria-label="Shuffle questions">
        🔀 Shuffle
      </button>
      <button class="btn-purple" onclick="addSelectedQuestions()" aria-label="Add selected questions">
        Add Selected
      </button>
      <button class="btn-purple" onclick="closeQuestionModal()" aria-label="Cancel selection">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Instagram Follow Button (Text Only) -->
<a href="https://www.instagram.com/looplabstech?igsh=MW11cDRoMnhmdDBqaw==" target="_blank" class="instagram-btn" aria-label="Follow us on Instagram">
  <div class="instagram-btn-text">
    <div class="instagram-btn-handle">@looplabstech</div>
    <div class="instagram-btn-action">Click to Follow</div>
  </div>
</a>

<!-- Install Prompt -->
<div id="installPrompt" class="install-prompt">
  <h4>Install BFF Quiz</h4>
  <p>Install our app for a better experience!</p>
  <button id="installBtn" aria-label="Install app">Install</button>
  <button id="dismissBtn" class="dismiss-btn" aria-label="Dismiss prompt">Not now</button>
</div>

<!-- Notification Container -->
<div id="notification" class="notification" role="alert" aria-live="polite">
  <div class="navigation-notification">
    <div class="notification-title"></div>
    <div class="notification-message"></div>
  </div>
</div>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1NQGWBSRLQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1NQGWBSRLQ');
</script>

<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      })
      .catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
  });
}
</script>

<script>
// --- MASSIVE QUESTION BANK (150+ Questions) ---
const allQuestions = [
    // Favorites
    { q: "What's my favorite food?", o: ["Pizza", "Biryani", "Pasta", "Burger"], a: "Biryani" },
    { q: "What's my favorite movie genre?", o: ["Action", "Comedy", "Sci-Fi", "Horror"], a: "Sci-Fi" },
    { q: "What is my favorite color?", o: ["Black", "Blue", "Red", "Green"], a: "Black" },
    { q: "What is my favorite season?", o: ["Winter", "Summer", "Monsoon", "Spring"], a: "Winter" },
    { q: "My favorite type of music?", o: ["Bollywood", "Hip-Hop", "Rock", "Pop"], a: "Bollywood" },
    { q: "My favorite animal?", o: ["Dog", "Cat", "Wolf", "Lion"], a: "Dog" },
    { q: "My favorite festival?", o: ["Diwali", "Holi", "Christmas", "Eid"], a: "Diwali" },
    { q: "My favorite superhero?", o: ["Iron Man", "Batman", "Spider-Man", "Superman"], a: "Iron Man" },
    { q: "My favorite ice cream flavor?", o: ["Chocolate", "Vanilla", "Butterscotch", "Strawberry"], a: "Chocolate" },
    { q: "My favorite Indian street food?", o: ["Pani Puri", "Samosa", "Vada Pav", "Chole Bhature"], a: "Pani Puri" },
    { q: "My favorite beverage?", o: ["Tea", "Coffee", "Juice", "Cold Drink"], a: "Coffee" },
    { q: "My favorite sport to watch?", o: ["Cricket", "Football", "Kabaddi", "Tennis"], a: "Cricket" },
    { q: "My favorite book genre?", o: ["Fantasy", "Mystery", "Biography", "Self-help"], a: "Fantasy" },
    { q: "My favorite dessert?", o: ["Gulab Jamun", "Cake", "Ice Cream", "Jalebi"], a: "Gulab Jamun" },
    { q: "My favorite social media app?", o: ["Instagram", "Twitter", "YouTube", "Snapchat"], a: "Instagram" },
    { q: "Which phone brand do I like most?", o: ["Apple", "Samsung", "OnePlus", "Google Pixel"], a: "OnePlus" },
    { q: "My favorite type of vacation?", o: ["Mountains", "Beaches", "City Tour", "Adventure Trip"], a: "Mountains" },
    { q: "My favorite subject in school was?", o: ["Math", "Science", "History", "Computers"], a: "Computers" },
    { q: "My favorite car brand?", o: ["BMW", "Mercedes", "Audi", "Tata"], a: "BMW" },
    { q: "My favorite fast food chain?", o: ["McDonald's", "KFC", "Domino's", "Subway"], a: "Domino's" },
    // Habits & Lifestyle
    { q: "Am I a morning person or a night owl?", o: ["Morning Person", "Night Owl", "Both", "Neither"], a: "Night Owl" },
    { q: "How do I prefer to travel?", o: ["Car", "Train", "Flight", "Bike"], a: "Bike" },
    { q: "What's my go-to outfit?", o: ["Jeans & T-shirt", "Formal Wear", "Kurta", "Tracksuit"], a: "Jeans & T-shirt" },
    { q: "How many languages can I speak?", o: ["One", "Two", "Three", "More than three"], a: "Two" },
    { q: "Do I prefer Android or iOS?", o: ["Android", "iOS", "Doesn't matter", "Hate both"], a: "Android" },
    { q: "My zodiac sign is?", o: ["Aries", "Leo", "Scorpio", "Capricorn"], a: "Scorpio" },
    { q: "Do I wear glasses?", o: ["Yes, always", "Only for reading", "No", "Contact lenses"], a: "Yes, always" },
    { q: "What is my biggest pet peeve?", o: ["Loud chewing", "Slow walkers", "People on phone", "Bad grammar"], a: "Loud chewing" },
    { q: "Am I an introvert or an extrovert?", o: ["Introvert", "Extrovert", "Ambivert", "Depends on mood"], a: "Ambivert" },
    { q: "How do I take my coffee/tea?", o: ["Black", "With milk & sugar", "Lots of sugar", "I don't drink it"], a: "With milk & sugar" },
    { q: "Am I a messy or a tidy person?", o: ["Very Tidy", "My Created", "A bit Messy", "Very Messy"], a: "A bit Messy" },
    { q: "What's my birth month?", o: ["January", "April", "August", "November"], a: "November" },
    { q: "Do I like spicy food?", o: ["Not at all", "A little bit", "Yes, quite spicy", "The spicier, the better!"], a: "The spicier, the better!" },
    { q: "How often do I exercise?", o: ["Every day", "A few times a week", "Rarely", "What's exercise?"], a: "Rarely" },
    { q: "Am I a planner or spontaneous?", o: ["I plan everything", "Mostly spontaneous", "A bit of both", "100% spontaneous"], a: "A bit of both" },
    { q: "What's one thing I can't live without?", o: ["My Phone", "Internet", "Family", "Food"], a: "My Phone" },
    { q: "What is my relationship status?", o: ["Single", "In a relationship", "It's complicated", "Ask me in person"], a: "Single" },
    { q: "Am I left-handed or right-handed?", o: ["Right-handed", "Left-handed", "Ambidextrous", "Guess!"], a: "Right-handed" },
    { q: "Do I sing in the shower?", o: ["Yes, always!", "Sometimes", "Never", "Only when no one's home"], a: "Only when no one's home" },
    { q: "What's my shoe size?", o: ["7", "8", "9", "10"], a: "9" },
    // Opinions & Preferences
    { q: "Which superpower would I choose?", o: ["Flying", "Invisibility", "Mind Reading", "Super Strength"], a: "Invisibility" },
    { q: "If I could live anywhere, where would it be?", o: ["New York", "A quiet village", "London", "Tokyo"], a: "Tokyo" },
    { q: "Movies or Web Series?", o: ["Movies", "Web Series", "Both", "Neither"], a: "Web Series" },
    { q: "What would I do with 1 crore rupees?", o: ["Travel the world", "Invest it", "Buy a house", "Start a business"], a: "Travel the world" },
    { q: "Do I believe in ghosts?", o: ["Yes, absolutely", "Maybe, not sure", "No, it's nonsense", "I want to believe"], a: "Maybe, not sure" },
    { q: "Which is better: Money or Fame?", o: ["Money", "Fame", "Both are important", "Neither is important"], a: "Money" },
    { q: "What's my dream job?", o: ["Doctor", "YouTuber", "Software Engineer", "Traveller"], a: "Traveller" },
    { q: "What's more important: looks or intelligence?", o: ["Looks", "Intelligence", "A balance of both", "Sense of humor"], a: "Sense of humor" },
    { q: "If I were an animal, I would be a:", o: ["Eagle", "Wolf", "Dolphin", "Panda"], a: "Wolf" },
    { q: "Do I prefer texting or calling?", o: ["Texting", "Calling", "Depends on person", "Video calls"], a: "Texting" },
    { q: "What's my opinion on pineapple on pizza?", o: ["Love it!", "It's a crime", "I can tolerate it", "Never tried it"], a: "It's a crime" },
    { q: "Which social cause do I care about most?", o: ["Environment", "Education", "Animal Welfare", "Poverty"], a: "Education" },
    { q: "Which character from 'Friends' am I most like?", o: ["Chandler", "Joey", "Monica", "Rachel"], a: "Chandler" },
    { q: "What's my biggest fear?", o: ["Heights", "Spiders", "Public speaking", "Failure"], a: "Failure" },
    { q: "What's a skill I want to learn?", o: ["Playing guitar", "A new language", "Coding", "Cooking"], a: "Playing guitar" },
    { q: "Which Hogwarts House would I be in?", o: ["Gryffindor", "Slytherin", "Ravenclaw", "Hufflepuff"], a: "Slytherin" },
    { q: "What's my ideal first date?", o: ["Coffee shop", "Fancy dinner", "Movie night", "Adventure activity"], a: "Adventure activity" },
    { q: "Do I prefer city life or village life?", o: ["City life", "Village life", "A mix of both", "Doesn't matter"], a: "City life" },
    { q: "What's a movie that made me cry?", o: ["Titanic", "3 Idiots", "Taare Zameen Par", "I don't cry in movies"], a: "Taare Zameen Par" },
    { q: "What am I most proud of?", o: ["My career", "My friends", "My education", "My honesty"], a: "My friends" },
    // Personal & Friendship
    { q: "Where did we first meet?", o: ["School", "College", "Work", "Online"], a: "College" },
    { q: "What is my nickname?", o: ["Sonu", "Raju", "Pappu", "I don't have one"], a: "Raju" },
    { q: "What's my middle name?", o: ["Kumar", "Singh", "Don't have one", "It's a secret"], a: "Kumar" },
    { q: "What am I most likely to be arrested for?", o: ["Speeding", "Arguing with police", "Hacking", "I'm a good citizen"], a: "Arguing with police" },
    { q: "What's the one word my friends use to describe me?", o: ["Funny", "Smart", "Loyal", "Crazy"], a: "Funny" },
    { q: "What is my biggest insecurity?", o: ["My looks", "My career", "My future", "I'm very secure"], a: "My future" },
    { q: "If I needed help, what would I ask for?", o: ["Money", "Advice", "A ride", "Emotional support"], a: "Emotional support" },
    { q: "What's my go-to excuse for being late?", o: ["Traffic", "Woke up late", "Feeling unwell", "I'm never late"], a: "Traffic" },
    { q: "What's my most used emoji?", o: ["😂", "❤️", "👍", "🤔"], a: "😂" },
    { q: "What do I value most in a friendship?", o: ["Honesty", "Loyalty", "Fun", "Support"], a: "Loyalty" },
    { q: "What's a secret I've never told anyone?", o: ["My first crush", "An embarrassing moment", "A hidden talent", "Nice try!"], a: "Nice try!" },
    { q: "What gift would I love the most?", o: ["Gadget", "A surprise trip", "Handmade gift", "Clothes"], a: "A surprise trip" },
    { q: "How many siblings do I have?", o: ["None (only child)", "One", "Two", "More than two"], a: "One" },
    { q: "What was the color of my school uniform?", o: ["Blue and White", "Brown and Cream", "Grey and White", "All White"], a: "Blue and White" },
    { q: "Which celebrity do I have a crush on?", o: ["Alia Bhatt", "Deepika Padukone", "Kiara Advani", "Disha Patani"], a: "Kiara Advani" },
    { q: "What's my dream bike/car?", o: ["Royal Enfield", "Harley-Davidson", "Lamborghini", "Thar"], a: "Thar" },
    { q: "Am I a dog person or a cat person?", o: ["Dog Person", "Cat Person", "Both", "Neither"], a: "Dog Person" },
    { q: "What's my biggest turn-off?", o: ["Arrogance", "Bad hygiene", "Lying", "Lack of ambition"], a: "Arrogance" },
    { q: "Which game am I best at?", o: ["BGMI/PUBG", "Chess", "Ludo", "Call of Duty"], a: "BGMI/PUBG" },
    { q: "What's my mother tongue?", o: ["Hindi", "English", "Marathi", "Bengali"], a: "Hindi" },
    // Hypotheticals
    { q: "If I could have dinner with one person (dead or alive), who would it be?", o: ["Albert Einstein", "Steve Jobs", "Shah Rukh Khan", "My Grandfather"], a: "Steve Jobs" },
    { q: "If I was stranded on a desert island, what 3 things would I take?", o: ["Knife, Water, Book", "Phone, Powerbank, Friend", "Food, Tent, Lighter", "You, me, and our talks"], a: "Knife, Water, Book" },
    { q: "If my life was a movie, what would its title be?", o: ["Comedy of Errors", "The Great Adventure", "Work in Progress", "Mission Impossible"], a: "Work in Progress" },
    { q: "If I found a wallet full of money, what would I do?", o: ["Return it to owner", "Keep the cash, return wallet", "Keep it all", "Donate to charity"], a: "Return it to owner" },
    { q: "If I could change one thing about myself, what would it be?", o: ["My laziness", "My anger", "My overthinking", "I'm perfect"], a: "My overthinking" },
    { q: "If I could time travel, would I go to the past or future?", o: ["Past", "Future", "Stay in the present", "Both"], a: "Future" },
    { q: "If I had to eat one food for the rest of my life, what would it be?", o: ["Dal Chawal", "Pizza", "Chicken Curry", "Noodles"], a: "Dal Chawal" },
    { q: "If I could be famous for one thing, what would it be?", o: ["Being an actor", "Being a scientist", "Being a humanitarian", "Being a sports star"], a: "Being a scientist" },
    { q: "If I get a day off, I would prefer to:", o: ["Sleep all day", "Go on a long drive", "Binge-watch shows", "Hang out with friends"], a: "Binge-watch shows" },
    { q: "If I were a flavour, what would I be?", o: ["Sweet", "Spicy", "Salty", "Sour"], a: "Spicy" },
    // NEW QUESTIONS - Tech & Social Media
    { q: "Which social media platform do I use most?", o: ["Instagram", "Facebook", "Twitter", "WhatsApp"], a: "Instagram" },
    { q: "What's my phone's wallpaper?", o: ["Nature", "Family/Friends", "Abstract", "Default"], a: "Family/Friends" },
    { q: "How many hours do I spend on my phone daily?", o: ["Less than 2 hours", "2-4 hours", "4-6 hours", "More than 6 hours"], a: "4-6 hours" },
    { q: "Which app do I check first thing in the morning?", o: ["WhatsApp", "Instagram", "Email", "News app"], a: "WhatsApp" },
    { q: "What's my favorite emoji to use?", o: ["😂", "❤️", "🔥", "😎"], a: "😂" },
    { q: "Do I prefer iOS or Android notifications?", o: ["iOS", "Android", "Don't care", "Turn off all notifications"], a: "Android" },
    { q: "What's my favorite tech gadget?", o: ["Smartphone", "Laptop", "Smartwatch", "Headphones"], a: "Smartphone" },
    { q: "How often do I post on social media?", o: ["Daily", "Weekly", "Rarely", "Never"], a: "Weekly" },
    { q: "What's my stance on taking photos of food?", o: ["Always do it", "Sometimes", "Rarely", "Never"], a: "Sometimes" },
    { q: "Which streaming service do I use most?", o: ["Netflix", "Amazon Prime", "Disney+", "YouTube"], a: "Netflix" },
    // NEW QUESTIONS - Pop Culture & Entertainment
    { q: "What's my favorite TV show currently?", o: ["Friends", "The Office", "Breaking Bad", "Stranger Things"], a: "Stranger Things" },
    { q: "Which movie could I watch over and over?", o: ["3 Idiots", "Dil Chahta Hai", "Inception", "The Avengers"], a: "3 Idiots" },
    { q: "Who's my favorite music artist?", o: ["A.R. Rahman", "Arijit Singh", "Badshah", "Neha Kakkar"], a: "Arijit Singh" },
    { q: "What's my go-to karaoke song?", o: ["Tum Hi Ho", "Lungi Dance", "Chaiyya Chaiyya", "Senorita"], a: "Tum Hi Ho" },
    { q: "Which concert would I love to attend?", o: ["Coldplay", "AR Rahman", "BTS", "Ed Sheeran"], a: "AR Rahman" },
    { q: "What's my favorite cartoon/anime?", o: ["Doraemon", "Naruto", "Tom & Jerry", "Dragon Ball Z"], a: "Naruto" },
    { q: "Which web series am I binge-watching?", o: ["Mirzapur", "Sacred Games", "Money Heist", "The Crown"], a: "Money Heist" },
    { q: "What's my favorite meme format?", o: ["Distracted Boyfriend", "Woman Yelling at Cat", "Drake Hotline Bling", "Two Buttons"], a: "Distracted Boyfriend" },
    { q: "Which reality show do I secretly enjoy?", o: ["Bigg Boss", "KBC", "Roadies", "Shark Tank India"], a: "Shark Tank India" },
    { q: "What's my favorite podcast genre?", o: ["Comedy", "True Crime", "Self-help", "Business"], a: "Comedy" },
    // NEW QUESTIONS - Lifestyle & Habits
    { q: "What's my sleeping position?", o: ["On my back", "On my side", "On my stomach", "All over the place"], a: "On my side" },
    { q: "How do I like my eggs in the morning?", o: ["Scrambled", "Fried", "Boiled", "I don't eat eggs"], a: "Scrambled" },
    { q: "What's my favorite time of day?", o: ["Morning", "Afternoon", "Evening", "Late night"], a: "Late night" },
    { q: "Do I prefer tea or coffee?", o: ["Tea", "Coffee", "Both equally", "Neither"], a: "Coffee" },
    { q: "What's my favorite way to relax?", o: ["Watching movies", "Reading books", "Listening to music", "Taking a nap"], a: "Watching movies" },
    { q: "How often do I order food delivery?", o: ["Almost daily", "2-3 times a week", "Once a week", "Rarely"], a: "2-3 times a week" },
    { q: "What's my favorite type of weather?", o: ["Sunny", "Rainy", "Cloudy", "Snowy"], a: "Rainy" },
    { q: "Do I prefer sweet or savory breakfast?", o: ["Sweet", "Savory", "Both", "I skip breakfast"], a: "Savory" },
    { q: "What's my biggest kitchen disaster?", o: ["Burnt food", "Salt instead of sugar", "Forgot key ingredient", "Set off smoke alarm"], a: "Salt instead of sugar" },
    { q: "How do I celebrate my birthday?", o: ["Big party", "Quiet dinner", "Trip", "Just like any other day"], a: "Quiet dinner" },
    // NEW QUESTIONS - Personality & Values
    { q: "What's my love language?", o: ["Words of Affirmation", "Acts of Service", "Receiving Gifts", "Quality Time"], a: "Quality Time" },
    { q: "How do I handle stress?", o: ["Talk to friends", "Exercise", "Binge-watch shows", "Isolate myself"], a: "Talk to friends" },
    { q: "What's my biggest strength?", o: ["Loyalty", "Creativity", "Intelligence", "Humor"], a: "Loyalty" },
    { q: "What's my biggest weakness?", o: ["Procrastination", "Overthinking", "Impatience", "Too trusting"], a: "Procrastination" },
    { q: "How do I make important decisions?", o: ["Pros and cons list", "Gut feeling", "Ask friends' opinion", "Flip a coin"], a: "Gut feeling" },
    { q: "What motivates me most?", o: ["Money", "Recognition", "Personal growth", "Making others happy"], a: "Personal growth" },
    { q: "How do I handle criticism?", o: ["Take it constructively", "Get defensive", "Ignore it", "Cry about it"], a: "Take it constructively" },
    { q: "What's my communication style?", o: ["Direct and blunt", "Diplomatic and tactful", "Passive", "Varies by situation"], a: "Varies by situation" },
    { q: "How do I show affection?", o: ["Hugs and physical touch", "Words of appreciation", "Doing favors", "Spending quality time"], a: "Spending quality time" },
    { q: "What's my life motto?", o: ["Carpe Diem", "This too shall pass", "Work hard, play harder", "Live and let live"], a: "Live and let live" },
    // NEW QUESTIONS - Travel & Experiences
    { q: "What's my dream travel destination?", o: ["Europe", "Southeast Asia", "USA", "Australia"], a: "Europe" },
    { q: "How do I prefer to travel?", o: ["Luxury resorts", "Budget backpacking", "Road trips", "Cruise ships"], a: "Road trips" },
    { q: "What's the best trip I've ever taken?", o: ["Family vacation", "Solo trip", "Trip with friends", "Business trip that felt like vacation"], a: "Trip with friends" },
    { q: "What's on my travel bucket list?", o: ["Northern Lights", "Safari in Africa", "Great Wall of China", "Machu Picchu"], a: "Northern Lights" },
    { q: "How do I pack for trips?", o: ["Minimalist", "Everything I might need", "Organized with lists", "Last minute chaos"], a: "Everything I might need" },
    { q: "What's my favorite type of vacation?", o: ["Beach relaxation", "Mountain adventure", "City exploration", "Cultural immersion"], a: "Mountain adventure" },
    { q: "Do I prefer planned itineraries or spontaneous exploration?", o: ["Detailed planning", "Completely spontaneous", "Mix of both", "Let others plan"], a: "Mix of both" },
    { q: "What's my favorite travel memory?", o: ["Watching sunrise/sunset", "Trying local food", "Getting lost in a new city", "Making local friends"], a: "Getting lost in a new city" },
    { q: "How many countries have I visited?", o: ["None", "1-3", "4-7", "More than 7"], a: "1-3" },
    { q: "What's my essential travel item?", o: ["Camera", "Comfortable shoes", "Power bank", "First aid kit"], a: "Power bank" },
    // NEW QUESTIONS - Food & Cooking
    { q: "What's my cooking skill level?", o: ["Master chef", "Pretty good", "Basic survival cooking", "Can burn water"], a: "Basic survival cooking" },
    { q: "What's my favorite cuisine?", o: ["Indian", "Italian", "Chinese", "Mexican"], a: "Indian" },
    { q: "Do I prefer cooking at home or eating out?", o: ["Love cooking", "Prefer eating out", "Equal balance", "Depends on mood"], a: "Equal balance" },
    { q: "What's my go-to comfort food?", o: ["Ice cream", "Chocolate", "Pizza", "Home-cooked meal"], a: "Pizza" },
    { q: "How spicy do I like my food?", o: ["Not spicy at all", "Mildly spicy", "Quite spicy", "Ghost pepper level"], a: "Quite spicy" },
    { q: "What's my favorite snack?", o: ["Chips", "Cookies", "Fruits", "Namkeen"], a: "Chips" },
    { q: "Do I have any food allergies?", o: ["Yes, serious", "Mild intolerance", "No allergies", "Not sure"], a: "No allergies" },
    { q: "What's my favorite cooking show?", o: ["MasterChef", "Village Cooking Channel", "Sanjeev Kapoor", "Don't watch cooking shows"], a: "Village Cooking Channel" },
    { q: "How do I like my steak/burger cooked?", o: ["Rare", "Medium rare", "Medium", "Well done"], a: "Medium" },
    { q: "What's my favorite guilty pleasure food?", o: ["Fast food", "Sweets", "Junk food", "Midnight snacks"], a: "Midnight snacks" },
    // NEW QUESTIONS - Work & Career
    { q: "What's my ideal work environment?", o: ["Office", "Work from home", "Hybrid", "Co-working space"], a: "Work from home" },
    { q: "How do I handle Monday blues?", o: ["Motivated and ready", "Need coffee to function", "Dread the day", "Don't believe in Monday blues"], a: "Need coffee to function" },
    { q: "What's my preferred meeting style?", o: ["Quick and to the point", "Detailed discussion", "Creative brainstorming", "Avoid meetings if possible"], a: "Quick and to the point" },
    { q: "How do I stay productive?", o: ["To-do lists", "Time blocking", "Last-minute pressure", "Natural flow"], a: "To-do lists" },
    { q: "What's my biggest work pet peeve?", o: ["Unnecessary meetings", "Micromanagement", "Slow internet", "Loud coworkers"], a: "Unnecessary meetings" },
    { q: "Do I prefer working alone or in a team?", o: ["Always alone", "Always in team", "Depends on project", "Mix of both"], a: "Mix of both" },
    { q: "What's my career goal?", o: ["CEO/Leadership", "Work-life balance", "Financial independence", "Making a difference"], a: "Work-life balance" },
    { q: "How do I celebrate work achievements?", o: ["Team dinner", "Quiet personal celebration", "Share on social media", "Move on to next thing"], a: "Quiet personal celebration" },
    { q: "What's my preferred work schedule?", o: ["9-5 traditional", "Flexible hours", "Night owl schedule", "Early bird"], a: "Flexible hours" },
    { q: "How do I handle work stress?", o: ["Exercise", "Talk to colleagues", "Take breaks", "Work through it"], a: "Take breaks" }
  ];

// Random Quiz Questions
const randomQuizQuestions = [
    {
        q: "What's the most important quality in a friendship?",
        o: ["Honesty", "Loyalty", "Trust", "Communication"],
        a: "Trust",
        e: "Trust forms the foundation of any strong friendship. Without trust, it's difficult to be vulnerable and open with your friends."
    },
    {
        q: "How often should friends check in on each other?",
        o: ["Daily", "Weekly", "Monthly", "Whenever we feel like it"],
        a: "Weekly",
        e: "Weekly check-ins strike a good balance between staying connected and giving each other space. Of course, this can vary based on the friendship!"
    },
    {
        q: "What's the best way to resolve a conflict with a friend?",
        o: ["Talk it out openly", "Give each other space", "Get a mutual friend to mediate", "Ignore it and hope it goes away"],
        a: "Talk it out openly",
        e: "Open communication is key to resolving conflicts. Addressing issues directly and honestly helps prevent misunderstandings from growing."
    },
    {
        q: "What's the ideal length of a friendship?",
        o: ["A few months", "A few years", "Many years", "Lifelong"],
        a: "Lifelong",
        e: "While all friendships have value, lifelong friendships that withstand the test of time are truly special and rare."
    }
];

let creatorName = '', currentQuizForCreation = [], selectedQuestionCount = 5;
let currentQuizData = null, currentQuestionIndex = 0, score = 0, takerName = '';
let currentRandomQuestion = null;

// --- AD QUEUE SYSTEM FOR FASTER LOADING ---
const adQueue = [];
let isProcessingAdQueue = false;

function queueAdLoad(containerId, adType, delay = 0) {
    adQueue.push({ containerId, adType, delay });
    processAdQueue();
}

function processAdQueue() {
    if (isProcessingAdQueue || adQueue.length === 0) return;
    
    isProcessingAdQueue = true;
    const nextAd = adQueue.shift();
    
    setTimeout(() => {
        loadAdScript(nextAd.containerId, nextAd.adType, 0);
        isProcessingAdQueue = false;
        
        // Process next ad in queue
        if (adQueue.length > 0) {
            processAdQueue();
        }
    }, nextAd.delay);
}

// --- IMPROVED AD LOADING FUNCTION ---
const loadedAds = new Set(); // Track loaded ads
const failedAds = new Set(); // Track failed ads

function loadAdScript(containerId, adType, retryCount = 0) {
    // Prevent duplicate loads
    if (loadedAds.has(containerId)) {
        console.log(`✅ Ad already loaded: ${containerId}`);
        return;
    }
    
    // Max 1 retry (reduced from 2)
    if (retryCount > 1) {
        console.error(`❌ Max retries reached for: ${containerId}`);
        failedAds.add(containerId);
        return;
    }
    
    const container = document.getElementById(containerId);
    if (!container) {
        console.warn(`⚠️ Container not found: ${containerId}`);
        return;
    }
    
    // Clear existing content
    container.innerHTML = '';
    
    const adKey = adType === '468x60' ? '837c179e6a1caff05c48c5e8d161fa74' : 'c0efb17d6a9b43764d3fe4e7973a31a0';
    const width = adType === '468x60' ? 468 : 300;
    const height = adType === '468x60' ? 60 : 250;
    
    // Create ad container
    const adDiv = document.createElement('div');
    adDiv.style.minHeight = `${height}px`;
    adDiv.style.width = '100%';
    adDiv.style.display = 'flex';
    adDiv.style.alignItems = 'center';
    adDiv.style.justifyContent = 'center';
    
    // Add loading indicator
    adDiv.innerHTML = '<div style="color: #666; font-size: 12px;">Loading ad...</div>';
    container.appendChild(adDiv);
    
    // Small delay before loading script
    setTimeout(() => {
        // Create options script - SIMPLIFIED
        const optionsScript = document.createElement('script');
        optionsScript.type = 'text/javascript';
        optionsScript.text = `
            var atOptions = {
                'key' : '${adKey}',
                'format' : 'iframe',
                'height' : ${height},
                'width' : ${width},
                'params' : {}
            };
        `;
        adDiv.appendChild(optionsScript);
        
        // Create invoke script - SIMPLIFIED
        const invokeScript = document.createElement('script');
        invokeScript.type = 'text/javascript';
        invokeScript.src = `//www.highperformanceformat.com/${adKey}/invoke.js?t=${Date.now()}`;
        invokeScript.async = false; // Changed to false for sequential loading
        
        let loadTimeout;
        
        invokeScript.onload = () => {
            clearTimeout(loadTimeout);
            console.log(`✅ Ad loaded: ${containerId} (attempt ${retryCount + 1})`);
            loadedAds.add(containerId);
            // Remove loading text
            const loadingText = adDiv.querySelector('div');
            if (loadingText && loadingText.textContent === 'Loading ad...') {
                loadingText.remove();
            }
        };
        
        invokeScript.onerror = () => {
            clearTimeout(loadTimeout);
            console.error(`❌ Ad failed: ${containerId} (attempt ${retryCount + 1})`);
            adDiv.innerHTML = '<div style="color: #666; font-size: 12px; padding: 10px;">Ad Space</div>';
            
            // Retry after delay
            if (retryCount < 1) {
                setTimeout(() => {
                    console.log(`🔄 Retrying ad: ${containerId}`);
                    loadAdScript(containerId, adType, retryCount + 1);
                }, 1000); // 1 second retry delay
            }
        };
        
        // Timeout fallback
        loadTimeout = setTimeout(() => {
            if (!loadedAds.has(containerId)) {
                console.warn(`⏱️ Ad timeout: ${containerId}`);
                invokeScript.onerror();
            }
        }, 4000); // Reduced timeout from 5000ms to 4000ms
        
        adDiv.appendChild(invokeScript);
    }, 100);
}

// --- LOAD ALL ADS WITH QUEUE SYSTEM ---
function loadAllAds() {
    // Clear queue first
    adQueue.length = 0;
    
    // Queue header ads first with small delay
    queueAdLoad('headerAd', '468x60', 200);
    queueAdLoad('headerAd2', '468x60', 500);
    
    // Then queue 300x250 ads with shorter gaps
    queueAdLoad('topAd', '300x250', 800);
    queueAdLoad('middleAd', '300x250', 1100);
    queueAdLoad('startQuizAd', '300x250', 1400);
    queueAdLoad('resultAd', '300x250', 1700);
    queueAdLoad('creatorHistoryAd', '300x250', 2000);
    queueAdLoad('playerHistoryAd', '300x250', 2300);
}

// --- IMAGE OPTIMIZATION ---
class ImageOptimizer {
  constructor() {
    this.init();
  }
  
  init() {
    this.checkWebPSupport();
    this.optimizeExistingImages();
    this.setupLazyLoading();
  }
  
  checkWebPSupport() {
    const webP = new Image();
    webP.onload = webP.onerror = () => {
      const isSupported = (webP.height === 2);
      document.body.classList.toggle('webp', isSupported);
      document.body.classList.toggle('no-webp', !isSupported);
    };
    webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
  }
  
  optimizeExistingImages() {
    const images = document.querySelectorAll('img:not([data-optimized])');
    
    images.forEach(img => {
      // Skip if already optimized
      if (img.dataset.optimized) return;
      
      // Add loading optimization
      img.loading = 'lazy';
      img.decoding = 'async';
      
      // Mark as optimized
      img.dataset.optimized = 'true';
    });
  }
  
  setupLazyLoading() {
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
            }
            
            observer.unobserve(img);
          }
        });
      });
      
      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
  }
}

// --- SEO FUNCTIONS ---

// Dynamic Meta Tags for Each Page
function updateMetaTags(page, data = {}) {
    const metaDescriptions = {
        home: "🔥 Create and share your own friendship quiz! See how well your friends know you with 150+ fun questions.",
        create: `${data.creator} is creating a personalized friendship quiz. Join thousands creating fun quizzes!`,
        play: `Take ${data.creator}'s friendship quiz! Test how well you know them with fun questions.`,
        result: `Quiz results for ${data.taker}! Score: ${data.score}/${data.total}. Create your own friendship quiz now!`
    };
    
    // Update description
    const descMeta = document.querySelector('meta[name="description"]');
    if (descMeta) descMeta.content = metaDescriptions[page] || metaDescriptions.home;
    
    // Update OG tags
    const ogDesc = document.querySelector('meta[property="og:description"]');
    if (ogDesc) ogDesc.content = metaDescriptions[page] || metaDescriptions.home;
}

// Add Breadcrumb Schema
function addBreadcrumbSchema(path) {
    const breadcrumbSchema = {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": []
    };
    
    const paths = {
        home: [{ name: "Home", url: window.location.origin }],
        create: [
            { name: "Home", url: window.location.origin },
            { name: "Create Quiz", url: `${window.location.origin}#create` }
        ],
        play: [
            { name: "Home", url: window.location.origin },
            { name: "Play Quiz", url: window.location.href }
        ]
    };
    
    const pathItems = paths[path] || paths.home;
    pathItems.forEach((item, index) => {
        breadcrumbSchema.itemListElement.push({
            "@type": "ListItem",
            "position": index + 1,
            "name": item.name,
            "item": item.url
        });
    });
    
    // Remove old breadcrumb schema if exists
    const oldSchema = document.querySelector('script[data-schema="breadcrumb"]');
    if (oldSchema) oldSchema.remove();
    
    // Add new schema
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.setAttribute('data-schema', 'breadcrumb');
    script.textContent = JSON.stringify(breadcrumbSchema);
    document.head.appendChild(script);
}

// Add Canonical Tags
function updateCanonicalTag() {
    let canonical = document.querySelector('link[rel="canonical"]');
    if (!canonical) {
        canonical = document.createElement('link');
        canonical.rel = 'canonical';
        document.head.appendChild(canonical);
    }
    
    // Remove hash for canonical URL
    const url = new URL(window.location.href);
    url.hash = '';
    canonical.href = url.toString();
}

// Add Review Schema (Dynamic)
function addReviewSchema() {
    const reviewSchema = {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "BFF Quiz",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "reviewCount": "1250",
            "bestRating": "5",
            "worstRating": "1"
        },
        "review": [
            {
                "@type": "Review",
                "author": { "@type": "Person", "name": "Priya Sharma" },
                "datePublished": "2024-10-25",
                "reviewBody": "Amazing app! Created a quiz for my friends and we had so much fun.",
                "reviewRating": { "@type": "Rating", "ratingValue": "5" }
            },
            {
                "@type": "Review",
                "author": { "@type": "Person", "name": "Rahul Verma" },
                "datePublished": "2024-10-20",
                "reviewBody": "Love this app! It's become our go-to activity at parties.",
                "reviewRating": { "@type": "Rating", "ratingValue": "4" }
            }
        ]
    };
    
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.setAttribute('data-schema', 'review');
    script.textContent = JSON.stringify(reviewSchema);
    document.head.appendChild(script);
}

// Add JSON-LD for Quiz Pages
function addQuizSchema(quizData) {
    const quizSchema = {
        "@context": "https://schema.org",
        "@type": "Quiz",
        "name": `${quizData.creator}'s Friendship Quiz`,
        "description": `Test how well you know ${quizData.creator} with this fun friendship quiz`,
        "numberOfQuestions": quizData.questions.length,
        "educationalLevel": "All Ages",
        "inLanguage": "en",
        "author": {
            "@type": "Person",
            "name": quizData.creator
        }
    };
    
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.setAttribute('data-schema', 'quiz');
    script.textContent = JSON.stringify(quizSchema);
    document.head.appendChild(script);
}

// H1 Optimization
const h1Optimization = {
    home: "Create Your Own BFF Friendship Quiz Online - Free Quiz Maker",
    create: "Design Your Personalized Friendship Quiz - 150+ Questions",
    play: "Test Your Friendship - Take the BFF Quiz Challenge",
    result: "Quiz Results & Leaderboard - See Who Knows You Best"
};

function updateH1(page) {
    const h1 = document.querySelector('h1');
    if (h1 && h1Optimization[page]) {
        h1.textContent = h1Optimization[page];
    }
}

// --- ADVANCED SHORT LINK GENERATOR ---
const ShortLinkGenerator = {
  // Character set (excluding similar looking chars: 0/O, 1/l, etc.)
  chars: 'abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789',
  
  // Generate short ID (6 characters)
  generateShortId: function() {
    let result = '';
    for (let i = 0; i < 6; i++) {
      result += this.chars.charAt(Math.floor(Math.random() * this.chars.length));
    }
    return result;
  },
  
  // Encode username into URL-safe format
  encodeUsername: function(username) {
    return btoa(username).replace(/[^a-zA-Z0-9]/g, '').substring(0, 8);
  },
  
  // Decode username from encoded format
  decodeUsername: function(encoded) {
    try {
      return atob(encoded);
    } catch (e) {
      return '';
    }
  },
  
  // Generate complete short link
  generateLink: function(creator) {
    const shortId = this.generateShortId();
    const encodedName = this.encodeUsername(creator);
    return `${shortId}-${encodedName}`;
  },
  
  // Parse link to get quiz ID and creator name
  parseLink: function(linkCode) {
    const parts = linkCode.split('-');
    return {
      id: parts[0],
      creator: parts[1] ? this.decodeUsername(parts[1]) : ''
    };
  }
};

// --- FOMO FEATURES ---

// 1. Live Player Counter
function updateLivePlayerCount() {
  const count = Math.floor(Math.random() * 50) + 100; // 100-150 players
  const badge = document.createElement('div');
  badge.className = 'fomo-badge';
  badge.innerHTML = `🔥 ${count} playing now!`;
  document.body.appendChild(badge);
}

// 2. Recent Activity Ticker
function showRecentActivity() {
  const activities = [
    'Priya just created a quiz!',
    'Rahul scored 10/10! 🎉',
    'Sneha challenged 5 friends!',
    'Arjun is playing now...',
    'Maya got 100% score! 🏆'
  ];
  
  const ticker = document.createElement('div');
  ticker.className = 'activity-ticker';
  
  function showActivity() {
    const activity = activities[Math.floor(Math.random() * activities.length)];
    ticker.textContent = activity;
    document.body.appendChild(ticker);
    
    setTimeout(() => {
      ticker.style.animation = 'slideOutLeft 0.5s ease-in';
      setTimeout(() => {
        if (ticker.parentNode) ticker.remove();
      }, 500);
    }, 4000);
  }
  
  // Show first activity after 5 seconds
  setTimeout(showActivity, 5000);
  
  // Show random activity every 15-20 seconds
  setInterval(() => {
    if (Math.random() < 0.5) { // 50% chance
      showActivity();
    }
  }, 15000);
}

// 3. Urgency Timer
function addUrgencyTimer() {
  const timer = document.createElement('div');
  timer.className = 'urgency-timer';
  
  let minutes = 4;
  let seconds = 59;
  
  function updateTimer() {
    timer.textContent = `⏰ Limited Offer: ${minutes}:${seconds.toString().padStart(2, '0')} left!`;
    
    if (seconds === 0) {
      if (minutes === 0) {
        minutes = 4;
        seconds = 59;
      } else {
        minutes--;
        seconds = 59;
      }
    } else {
      seconds--;
    }
  }
  
  updateTimer();
  setInterval(updateTimer, 1000);
  
  document.body.appendChild(timer);
}

// 4. Social Proof Popup
function showSocialProof() {
  const proofs = [
    { name: 'Anjali from Mumbai', action: 'just created a quiz', time: '2 min ago' },
    { name: 'Vikram from Delhi', action: 'scored 100%', time: '5 min ago' },
    { name: 'Neha from Pune', action: 'challenged 10 friends', time: '8 min ago' }
  ];
  
  const popup = document.createElement('div');
  popup.className = 'social-proof-popup';
  
  function showProof() {
    const proof = proofs[Math.floor(Math.random() * proofs.length)];
    popup.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px;">
        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ff6bcb, #ff9a00); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
          👤
        </div>
        <div>
          <div style="font-weight: bold; color: #0f0f23;">${proof.name}</div>
          <div style="font-size: 12px; color: #666;">${proof.action}</div>
          <div style="font-size: 11px; color: #999;">${proof.time}</div>
        </div>
      </div>
    `;
    
    document.body.appendChild(popup);
    
    setTimeout(() => {
      popup.style.transform = 'translateY(0)';
    }, 100);
    
    setTimeout(() => {
      popup.style.transform = 'translateY(150%)';
      setTimeout(() => {
        if (popup.parentNode) popup.remove();
      }, 500);
    }, 5000);
  }
  
  // Show first proof after 8 seconds
  setTimeout(showProof, 8000);
  
  // Show random proof every 20-30 seconds
  setInterval(() => {
    if (Math.random() < 0.4) {
      showProof();
    }
  }, 25000);
}

// --- Custom Quiz Storage System ---
const CustomQuizStorage = {
    // Save quiz data and return a short ID
    saveQuiz: function(quizData) {
        try {
            // Generate a unique ID
            const id = this.generateShortId();
            
            // Store the quiz data
            localStorage.setItem(`quiz_${id}`, JSON.stringify(quizData));
            
            // Add to index for easier retrieval
            let index = JSON.parse(localStorage.getItem('quizIndex') || '[]');
            index.push({
                id: id,
                creator: quizData.creator,
                created: new Date().toISOString(),
                expiry: quizData.expiry
            });
            localStorage.setItem('quizIndex', JSON.stringify(index));
            
            return id;
        } catch (e) {
            console.error("Failed to save quiz:", e);
            throw new Error("Could not save quiz data");
        }
    },
    
    // Load quiz data by ID
    loadQuiz: function(id) {
        try {
            const quizData = JSON.parse(localStorage.getItem(`quiz_${id}`));
            if (!quizData) {
                throw new Error("Quiz not found");
            }
            
            // Check if quiz has expired
            if (new Date() > new Date(quizData.expiry)) {
                throw new Error("Quiz has expired");
            }
            
            return quizData;
        } catch (e) {
            console.error("Failed to load quiz:", e);
            throw new Error("Could not load quiz data");
        }
    },
    
    // Generate a short ID
    generateShortId: function() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < 8; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    },
    
    // Clean up expired quizzes
    cleanupExpiredQuizzes: function() {
        try {
            const index = JSON.parse(localStorage.getItem('quizIndex') || '[]');
            const now = new Date();
            
            const updatedIndex = index.filter(item => {
                if (new Date(item.expiry) > now) {
                    return true; // Keep non-expired quizzes
                } else {
                    // Remove expired quiz data
                    localStorage.removeItem(`quiz_${item.id}`);
                    return false; // Remove from index
                }
            });
            
            localStorage.setItem('quizIndex', JSON.stringify(updatedIndex));
        } catch (e) {
            console.error("Failed to cleanup expired quizzes:", e);
        }
    }
};

// --- NOTIFICATION SYSTEM ---
function showNotification(title, message, type = 'success') {
  const notification = document.getElementById('notification');
  const titleEl = notification.querySelector('.notification-title');
  const messageEl = notification.querySelector('.notification-message');
  
  titleEl.textContent = title;
  messageEl.textContent = message;
  
  notification.className = 'notification show ' + type;
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

// --- PWA Install Prompt ---
let deferredPrompt;
const installPrompt = document.getElementById('installPrompt');
const installBtn = document.getElementById('installBtn');
const dismissBtn = document.getElementById('dismissBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  setTimeout(() => {
    installPrompt.classList.add('show');
  }, 3000);
});

installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') {
      console.log('User accepted the install prompt');
      showNotification('Success!', 'BFF Quiz has been installed on your device.');
    } else {
      console.log('User dismissed the install prompt');
    }
    deferredPrompt = null;
    installPrompt.classList.remove('show');
  }
});

dismissBtn.addEventListener('click', () => {
  installPrompt.classList.remove('show');
});

// --- Page Navigation ---
function showPage(pageId) { 
  document.querySelectorAll('.container').forEach(el => el.classList.add('hidden')); 
  document.getElementById(pageId).classList.remove('hidden');
  
  // Update SEO elements for the new page
  updateCanonicalTag();
  updateH1(pageId);
  updateMetaTags(pageId);
  addBreadcrumbSchema(pageId);
}

// --- RESET AND GO HOME FUNCTION ---
function resetAndGoHome() {
    // Reset all quiz state variables
    creatorName = '';
    currentQuizForCreation = [];
    selectedQuestionCount = 5;
    currentQuizData = null;
    currentQuestionIndex = 0;
    score = 0;
    takerName = '';
    currentRandomQuestion = null;
    
    // Clear input fields
    document.getElementById('userName').value = '';
    document.getElementById('takerName').value = '';
    
    // Reset URL hash
    window.location.hash = '';
    
    // Navigate to home page
    showPage('home');
    
    // Show success notification
    showNotification('Success', 'Ready to create a new quiz!');
}

// --- Random Quiz Functions ---
function showRandomQuiz() {
  showPage('randomQuizPage');
  generateNewRandomQuestion();
}

function generateNewRandomQuestion() {
  // Reset result view if visible
  document.getElementById('randomQuiz').classList.remove('hidden');
  document.getElementById('randomResult').classList.add('hidden');
  
  // Select a random question
  const randomIndex = Math.floor(Math.random() * randomQuizQuestions.length);
  currentRandomQuestion = randomQuizQuestions[randomIndex];
  
  // Display the question
  document.getElementById('randomQuiz').classList.remove('hidden');
  document.getElementById('randomResult').classList.add('hidden');
  
  // Display the question
  document.getElementById('randomQuestionText').textContent = currentRandomQuestion.q;
  
  // Create option elements
  const optionsContainer = document.getElementById('randomOptions');
  optionsContainer.innerHTML = '';
  
  currentRandomQuestion.o.forEach((option, index) => {
    const optionDiv = document.createElement('div');
    optionDiv.className = 'option-item';
    optionDiv.innerHTML = `
      <input type="radio" id="randomOption${index}" name="randomAnswer" value="${option}">
      <label for="randomOption${index}">${option}</label>
    `;
    optionsContainer.appendChild(optionDiv);
  });
}

function submitRandomQuiz() {
  const selectedOption = document.querySelector('input[name="randomAnswer"]:checked');
  
  if (!selectedOption) {
    showNotification('Error', 'Please select an answer!', 'error');
    return;
  }
  
  // Show result
  document.getElementById('randomQuiz').classList.add('hidden');
  document.getElementById('randomResult').classList.remove('hidden');
  
  const isCorrect = selectedOption.value === currentRandomQuestion.a;
  document.getElementById('randomAnswerText').textContent = 
    `You selected: ${selectedOption.value} ${isCorrect ? '✓' : '✗'}`;
  
  document.getElementById('randomExplanation').textContent = currentRandomQuestion.e;
  
  // Show notification
  showNotification(
    isCorrect ? 'Correct!' : 'Not quite', 
    isCorrect ? 'Great job! You understand this aspect of friendship.' : 'That\'s an interesting perspective! Every friendship is different.'
  );
}

// --- About Page Functions ---
function showAboutPage() {
  showPage('aboutPage');
}

// --- Home Page Logic ---
function showCreate() {
    creatorName = document.getElementById('userName').value.trim();
    if (!creatorName) { 
      showNotification('Error', 'Please enter your name first!', 'error');
      return; 
    }
    setQuestionCount(5); 
    showPage('create');
}
function showCreatorHistory() {
    const history = JSON.parse(localStorage.getItem('creatorHistory') || '[]');
    const listEl = document.getElementById('creatorHistoryList');
    listEl.innerHTML = history.length === 0 ? '<p>You have not created any quizzes yet.</p>' : '';
    history.reverse().forEach(item => {
        const quiz = item.quiz;
        const isExpired = new Date() > new Date(quiz.expiry);
        const div = document.createElement('div');
        div.className = 'quiz-history-item';
        div.innerHTML = `<strong>Quiz created on ${new Date(item.date).toLocaleDateString()}</strong><br>
                         ${quiz.questions.length} questions, by ${quiz.creator}
                         ${isExpired ? '<div class="expiry-notice" style="color:#ff6b6b; font-size:0.8rem;">EXPIRED</div>' : ''}`;
        div.onclick = () => showLeaderboardForCreator(item.quiz.id, `Quiz from ${new Date(item.date).toLocaleDateString()}`);
        listEl.appendChild(div);
    });
    showCreatorHistoryList();
    showPage('creatorHistoryPage');
}
function showPlayerHistory() {
    const history = JSON.parse(localStorage.getItem('playerHistory') || '[]');
    const listEl = document.getElementById('playerHistoryList');
    listEl.innerHTML = history.length === 0 ? "<p>You haven't played any quizzes yet. Your scores will appear here.</p>" : "";
    history.reverse().forEach(item => {
        const div = document.createElement('div');
        div.className = 'quiz-history-item';
        div.innerHTML = `<strong>Quiz by ${item.creator}</strong><br>
                         Your Score: <b>${item.score}/${item.total}</b> | Played on: ${new Date(item.date).toLocaleDateString()}`;
        div.onclick = () => window.location.href = item.url;
        listEl.appendChild(div);
    });
    showPage('playerHistoryPage');
}

// --- Creator Leaderboard Logic ---
function showLeaderboardForCreator(quizId, quizTitle) {
    document.getElementById('creatorHistoryWrapper').classList.add('hidden');
    const view = document.getElementById('creatorLeaderboardView');
    view.classList.remove('hidden');

    document.getElementById('creatorLeaderboardTitle').textContent = `Leaderboard for: ${quizTitle}`;
    const listEl = document.getElementById('creatorLeaderboardList');
    const allScores = JSON.parse(localStorage.getItem('allScores') || '{}');
    const leaderboardData = allScores[quizId] || [];
    
    document.getElementById('creatorPlayerCount').textContent = `Total Players: ${leaderboardData.length}`;

    if (leaderboardData.length === 0) listEl.innerHTML = '<p style="text-align:center; margin-top:20px;">No one has played this quiz yet.</p>';
    else listEl.innerHTML = leaderboardData.map((entry, index) => `<div class="leaderboard-item"><strong>${index + 1}. ${entry.name}</strong><span style="float:right; font-weight:bold;">${entry.score}/${entry.total}</span></div>`).join('');
}
function showCreatorHistoryList() {
    document.getElementById('creatorHistoryWrapper').classList.remove('hidden');
    document.getElementById('creatorLeaderboardView').classList.add('hidden');
}


// --- Quiz Creation Logic ---
function setQuestionCount(count) {
    selectedQuestionCount = count;
    document.querySelectorAll('.count-btn').forEach(btn => btn.classList.remove('active-count'));
    const btnIndex = [5,10,15,20].indexOf(count);
    if(btnIndex > -1) document.querySelector(`.count-btn:nth-child(${btnIndex+1})`).classList.add('active-count');
    currentQuizForCreation = [];
    renderCreationQuestions();
}
function showQuestionModal() { 
  document.getElementById('questionModal').classList.remove('hidden');
  renderModalList(); 
}
function closeQuestionModal() { 
  document.getElementById('questionModal').classList.add('hidden'); 
}
function renderModalList() {
    const listEl = document.getElementById('questionList');
    const filter = document.getElementById('questionSearch').value.toLowerCase();
    listEl.innerHTML = '';
    
    const filteredQuestions = allQuestions.filter(q => q.q.toLowerCase().includes(filter));
    
    filteredQuestions.forEach(q => {
        const originalIndex = allQuestions.indexOf(q);
        const item = document.createElement('label');
        item.className = 'question-item';
        item.innerHTML = `<input type="checkbox" value="${originalIndex}"><span class="question-item-text">${q.q}</span>`;
        listEl.appendChild(item);
    });
    updateModalCounter();
}
function updateModalCounter() {
    const selectedCount = document.querySelectorAll('#questionList input[type="checkbox"]:checked').length;
    document.getElementById('modalCounter').textContent = `${selectedCount} / ${selectedQuestionCount} selected`;
}
document.getElementById('questionList').addEventListener('change', updateModalCounter);
function addSelectedQuestions() {
    const selectedCheckboxes = document.querySelectorAll('#questionList input[type="checkbox"]:checked');
    if (selectedCheckboxes.length > selectedQuestionCount) { 
      showNotification('Error', `You can select a maximum of ${selectedQuestionCount} questions.`, 'error');
      return; 
    }
    if (selectedCheckboxes.length === 0) { 
      showNotification('Error', 'Please select at least one question.', 'error');
      return; 
    }
    currentQuizForCreation = Array.from(selectedCheckboxes).map(cb => JSON.parse(JSON.stringify(allQuestions[cb.value])));
    renderCreationQuestions(); 
    closeQuestionModal();
    showNotification('Success', 'Questions added successfully!');
}
function shuffleSelectedQuestions() {
    if (currentQuizForCreation.length === 0) { 
      showNotification('Error', 'Please select questions before shuffling.', 'error');
      return; 
    }
    for (let i = currentQuizForCreation.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentQuizForCreation[i], currentQuizForCreation[j]] = [currentQuizForCreation[j], currentQuizForCreation[i]];
    }
    renderCreationQuestions();
    showNotification('Success', 'Your selected questions have been shuffled!');
}
function renderCreationQuestions() {
    const container = document.getElementById('questionsContainer');
    container.innerHTML = '';
    
    if (currentQuizForCreation.length === 0) {
        container.innerHTML = '<p style="text-align:center; opacity: 0.7;">Your selected questions will appear here for final review.</p>';
        document.getElementById('creationControls').classList.add('hidden');
        document.getElementById('questionCounter').textContent = '';
        return;
    }
    
    // Add the edit note
    const editNote = document.createElement('div');
    editNote.className = 'edit-note';
    editNote.textContent = 'You can edit your questions and answers for a better experience';
    container.appendChild(editNote);
    
    // Add questions with ad after every question
    currentQuizForCreation.forEach((q, index) => {
        container.appendChild(createQuestionBlock(q, index));
        
        // Add ad banner after every question (but not after the last question)
        if (index < currentQuizForCreation.length - 1) {
            const adBanner = document.createElement('div');
            adBanner.className = 'ad-space ad-space-horizontal';
            adBanner.id = `questionAd${index}`;
            container.appendChild(adBanner);
            
            // Queue ad loading with minimal delay for faster loading
            queueAdLoad(`questionAd${index}`, '468x60', 200 + (index * 100));
        }
    });
    
    document.getElementById('questionCounter').textContent = `Reviewing ${currentQuizForCreation.length} Questions`;
    document.getElementById('creationControls').classList.remove('hidden');
}
function createQuestionBlock(q, index) {
    const div = document.createElement('div');
    div.className = 'question-block';
    div.innerHTML = `<input type="text" class="question-title" value="${q.q}" oninput="updateCreationQuestion(${index}, 'q', this.value)">
        ${q.o.map((opt, optIndex) => `<div class="option-item"><input type="radio" name="correct-ans-${index}" value="${opt}" ${q.a === opt ? 'checked' : ''} onchange="updateCreationAnswer(${index}, this.value)"><input type="text" value="${opt}" oninput="updateCreationOption(${index}, ${optIndex}, this.value)">${q.a === opt ? '<span class="correct-tick">✓</span>' : ''}</div>`).join('')}`;
    return div;
}

function updateCreationQuestion(index, key, value) {
    currentQuizForCreation[index][key] = value;
}

function updateCreationOption(qIndex, optIndex, value) {
    const oldVal = currentQuizForCreation[qIndex].o[optIndex];
    if (currentQuizForCreation[qIndex].a === oldVal) {
        currentQuizForCreation[qIndex].a = value;
    }
    currentQuizForCreation[qIndex].o[optIndex] = value;
}
function updateCreationAnswer(index, value) {
    currentQuizForCreation[index].a = value;
    renderCreationQuestions(); // Refresh only when radio button is clicked
}

// --- Quiz Creation with Custom Storage ---
async function finishAndShareQuiz() {
    const finishButton = document.querySelector('#creationControls button:last-child');
    finishButton.disabled = true;
    finishButton.textContent = 'Creating Link...';

    const expiryDate = new Date(); 
    expiryDate.setHours(expiryDate.getHours() + 24);
    
    // Generate short link code
    const linkCode = ShortLinkGenerator.generateLink(creatorName);
    
    const quizData = { 
        id: linkCode, // Use short code as ID
        creator: creatorName, 
        questions: currentQuizForCreation, 
        expiry: expiryDate.toISOString() 
    };

    try {
        CustomQuizStorage.cleanupExpiredQuizzes();
        localStorage.setItem(`quiz_${linkCode}`, JSON.stringify(quizData));
        
        // SHORT URL: bffquiz.com/q/Abc123-TmFtZQ
        const url = `${window.location.origin}${window.location.pathname}#q/${linkCode}`;
        
        saveCreatorHistory(quizData, url); 
        displayShareableLink(url);
    } catch (e) {
        console.error("Quiz creation failed:", e);
        showNotification('Error', 'Could not create quiz link. Please try again.', 'error');
    } finally {
        finishButton.disabled = false;
        finishButton.textContent = 'Finish & Share Link';
    }
}
function saveCreatorHistory(quizData, url) {
    let history = JSON.parse(localStorage.getItem('creatorHistory') || '[]');
    history.push({ quiz: quizData, url: url, date: new Date().toISOString() });
    if (history.length > 20) history.shift();
    localStorage.setItem('creatorHistory', JSON.stringify(history));
}
function displayShareableLink(url) {
    showPage('result');
    document.getElementById('resultTitle').textContent = "Quiz Created Successfully!";
    document.getElementById('leaderboard').classList.add('hidden');
    document.getElementById('scoreText').innerHTML = `<p style="text-align:center;">Your quiz is ready to be shared!</p>`;
    const shareBox = document.getElementById('shareBox');
    shareBox.classList.remove('hidden');
    document.getElementById('shareLink').textContent = url;
    // Fixed URL generation for share message
    const homeUrl = window.location.origin + window.location.pathname;
    const shareMessage = `🔥 ${creatorName} has challenged you to a Friendship Quiz! 🔥\n\n"Kya tum sach me mujhe jaante ho? 🤔\n\nClick here to prove it and see your score! 👉 ${url}\n\n---\n👉 Create your own quiz here: ${homeUrl}`;
    const encodedShareMessage = encodeURIComponent(shareMessage);
    const encodedUrl = encodeURIComponent(url);
    const encodedTitle = encodeURIComponent(`🔥 ${creatorName} has challenged you!`);
    
    // Create social share buttons with ads between them
    const socialButtonsHTML = [];
    
    // Add Copy Quiz Link button
    socialButtonsHTML.push(`<button class="btn-purple social-btn-stacked" onclick="copyToClipboard(document.getElementById('shareLink').textContent)">Copy Quiz Link</button>`);
    
    // Add ad after first button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd1" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add WhatsApp button
    socialButtonsHTML.push(`<a href="https://api.whatsapp.com/send?text=${encodedShareMessage}" target="_blank" class="btn-purple social-btn-stacked">WhatsApp</a>`);
    
    // Add ad after second button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd2" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add Telegram button
    socialButtonsHTML.push(`<a href="https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}" target="_blank" class="btn-purple social-btn-stacked">Telegram</a>`);
    
    // Add ad after third button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd3" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add Facebook button (Fixed URL)
    socialButtonsHTML.push(`<a href="https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}" target="_blank" class="btn-purple social-btn-stacked">Facebook</a>`);
    
    // Add ad after fourth button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd4" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add Instagram button
    socialButtonsHTML.push(`<button onclick="shareOnInstagram()" class="btn-purple social-btn-stacked">Instagram</button>`);
    
    // Add ad after fifth button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd5" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add Twitter button
    socialButtonsHTML.push(`<a href="https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}" target="_blank" class="btn-purple social-btn-stacked">Twitter</a>`);
    
    // Add ad after sixth button
    socialButtonsHTML.push(`<div class="ad-space ad-space-horizontal" id="shareAd6" style="margin: 10px 0;"><!-- Ad will be loaded by JavaScript --></div>`);
    
    // Add Threads button
    socialButtonsHTML.push(`<a href="https://www.threads.net/share?text=${encodedTitle}&url=${encodedUrl}" target="_blank" class="btn-purple social-btn-stacked">Threads</a>`);
    
    document.getElementById('socialShareButtons').innerHTML = socialButtonsHTML.join('');
    
    // Queue ads with shorter delays for faster loading
    queueAdLoad('shareAd1', '468x60', 200);
    queueAdLoad('shareAd2', '468x60', 500);
    queueAdLoad('shareAd3', '468x60', 800);
    queueAdLoad('shareAd4', '468x60', 1100);
    queueAdLoad('shareAd5', '468x60', 1400);
    queueAdLoad('shareAd6', '468x60', 1700);
}
function shareOnInstagram() {
    const url = document.getElementById('shareLink').textContent;
    navigator.clipboard.writeText(`Check out this quiz! ${url}`).then(() => {
        showNotification('Success', 'Link Copied! Now opening Instagram. Paste the link in your story or bio.');
        window.open('https://www.instagram.com', '_blank');
    });
}
function copyToClipboard(text) { 
  navigator.clipboard.writeText(text).then(() => {
    showNotification('Success', 'Link copied!');
  }, () => {
    showNotification('Error', 'Failed to copy.', 'error'); 
  }); 
}

// --- Quiz Taking & Results Logic ---
async function routeOnLoad() {
    const hash = window.location.hash;
    const path = window.location.pathname;
    
    // Check if it's the about page
    if (path === '/about') {
        showAboutPage();
        return;
    }
    
    // Check if it's the random quiz page
    if (path === '/random') {
        showRandomQuiz();
        return;
    }
    
    // Handle short link format: #q/Abc123-TmFtZQ
    if (hash.startsWith('#q/')) {
        const linkCode = hash.substring(3); // Remove #q/
        
        try {
            const quizData = JSON.parse(localStorage.getItem(`quiz_${linkCode}`));
            
            if (!quizData) {
                throw new Error("Quiz not found");
            }
            
            if (new Date() > new Date(quizData.expiry)) {
                throw new Error("Quiz has expired");
            }
            
            currentQuizData = quizData;
            showPage('play');
            
            // Parse creator name from link
            const linkInfo = ShortLinkGenerator.parseLink(linkCode);
            document.getElementById('quizTitle').textContent = `${linkInfo.creator}'s Friendship Quiz 🎯`;
            document.getElementById('playTakerName').classList.remove('hidden');
            document.getElementById('quizContentWrapper').classList.add('hidden');
            
            addQuizSchema(currentQuizData);
        } catch (e) { 
          console.error("Error loading quiz:", e); 
          showPage('home'); 
          showNotification('Error', 'Invalid or expired quiz link.', 'error');
          window.location.hash = ''; 
        }
        return;
    }
    
    if (hash.startsWith('#play?id=')) {
        const params = new URLSearchParams(hash.substring(6)); // #play?id=... -> id=...
        const id = params.get('id');
        if (!id) {
            showPage('home');
            return;
        }
        try {
            // Try to load using custom storage first
            currentQuizData = CustomQuizStorage.loadQuiz(id);
            
            showPage('play');
            document.getElementById('quizTitle').textContent = `A quiz by ${currentQuizData.creator}`;
            document.getElementById('playTakerName').classList.remove('hidden');
            document.getElementById('quizContentWrapper').classList.add('hidden');
            
            // Add quiz schema for SEO
            addQuizSchema(currentQuizData);
        } catch (e) { 
          console.error("Error loading quiz data:", e); 
          showPage('home'); 
          showNotification('Error', 'Invalid or expired quiz link.', 'error');
          window.location.hash = ''; 
        }
    } else if (hash.startsWith('#dummy')) {
        showPage('dummyPage');
    } else if (hash.startsWith('#hidden')) {
        showPage('hiddenPage');
    } else { 
        showPage('home');
        // Add review schema on home page
        addReviewSchema();
    }
}
function startQuiz() {
    takerName = document.getElementById('takerName').value.trim();
    if (!takerName) { 
      showNotification('Error', 'Please enter your name to start.', 'error');
      return; 
    }
    document.getElementById('playTakerName').classList.add('hidden');
    document.getElementById('quizContentWrapper').classList.remove('hidden');
    loadQuestion();
}
function loadQuestion() {
    if (currentQuestionIndex >= currentQuizData.questions.length) { finishQuiz(); return; }
    const q = currentQuizData.questions[currentQuestionIndex];
    
    // Create ad after every question
    let adHtml = '';
    if (currentQuestionIndex < currentQuizData.questions.length - 1) {
        adHtml = `<div class="ad-space ad-space-horizontal" id="quizAd${currentQuestionIndex}" style="margin: 15px 0;">
            <!-- Ad will be loaded by JavaScript -->
        </div>`;
    }
    
    document.getElementById('quizContent').innerHTML = `
        <div class="question-block">
            <h3>Q ${currentQuestionIndex + 1}: ${q.q}</h3>
            <div class="option-grid">${q.o.map(opt => `<label class="option-item"><input type="radio" name="answer" value="${opt}">${opt}</label>`).join("")}</div>
            <button class="btn-purple" onclick="submitAnswer()">Next Question</button>
        </div>
        ${adHtml}
    `;
    
    // Queue ad loading if needed with minimal delay for faster loading
    if (currentQuestionIndex < currentQuizData.questions.length - 1) {
        queueAdLoad(`quizAd${currentQuestionIndex}`, '468x60', 200);
    }
}
function submitAnswer() {
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) { 
      showNotification('Error', 'Please select an answer.', 'error');
      return; 
    }
    if (selected.value === currentQuizData.questions[currentQuestionIndex].a) score++;
    currentQuestionIndex++; 
    loadQuestion();
}
function finishQuiz() { 
  saveScore(); 
  displayResults(); 
  showNotification('Quiz Complete!', `You scored ${score} out of ${currentQuizData.questions.length}!`);
}
function displayResults() {
    showPage('result');
    document.getElementById('resultTitle').textContent = "Quiz Complete!";
    document.getElementById('leaderboard').classList.remove('hidden');
    document.getElementById('shareBox').classList.add('hidden');
    document.getElementById('quizContentWrapper').classList.add('hidden');
    document.getElementById('scoreText').innerHTML = `<h3 style="text-align:center;">Congratulations, ${takerName}!</h3><p style="font-size: 1.2rem; margin: 10px 0; text-align:center;">You scored ${score} out of ${currentQuizData.questions.length}</p>`;
    
    // Update meta tags for result page
    updateMetaTags('result', { taker: takerName, score: score, total: currentQuizData.questions.length });
    
    updateLeaderboard();
}
function saveScore() {
    const quizId = currentQuizData.id;
    // Save to leaderboard
    let allScores = JSON.parse(localStorage.getItem('allScores') || '{}');
    if (!allScores[quizId]) allScores[quizId] = [];
    const existingIndex = allScores[quizId].findIndex(e => e.name === takerName);
    if (existingIndex > -1) { if (score > allScores[quizId][existingIndex].score) allScores[quizId][existingIndex] = { name: takerName, score, total: currentQuizData.questions.length }; }
    else { 
        allScores[quizId].push({ name: takerName, score, total: currentQuizData.questions.length, date: new Date().toISOString(), url: window.location.href });
        // Save to player history
        let playerHistory = JSON.parse(localStorage.getItem('playerHistory') || '[]');
        playerHistory.push({ 
            creator: currentQuizData.creator, 
            score: score, 
            total: currentQuizData.questions.length, 
            date: new Date().toISOString(), 
            url: window.location.href 
        });
        if(playerHistory.length > 20) playerHistory.shift();
        localStorage.setItem('playerHistory', JSON.stringify(playerHistory));
    }
    localStorage.setItem('allScores', JSON.stringify(allScores));
}
function updateLeaderboard() {
    const listEl = document.getElementById('leaderboardList');
    const allScores = JSON.parse(localStorage.getItem('allScores') || '{}');
    const leaderboardData = allScores[currentQuizData.id] || [];
    if (leaderboardData.length === 0) listEl.innerHTML = '<p>Be the first to set a score!</p>';
    else listEl.innerHTML = leaderboardData.map((entry, index) => `<div class="leaderboard-item"><strong>${index + 1}. ${entry.name}</strong><span style="float:right; font-weight:bold;">${entry.score}/${entry.total}</span></div>`).join('');
}

// --- MODAL SHUFFLE FUNCTION ---
function shuffleModalQuestions() {
    const listEl = document.getElementById('questionList');
    const items = Array.from(listEl.children);
    
    // Fisher-Yates shuffle
    for (let i = items.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        listEl.insertBefore(items[j], items[i].nextSibling);
    }
    
    showNotification('Success', 'Questions shuffled!');
}

// Simplified initialization
window.addEventListener('load', () => {
    // Route to the correct page
    routeOnLoad();
    
    // Load all ads with queue system
    loadAllAds();
    
    // Initialize SEO elements
    updateCanonicalTag();
    updateH1('home');
    updateMetaTags('home');
    addBreadcrumbSchema('home');
    
    // Initialize image optimizer
    new ImageOptimizer();
    
    // Initialize FOMO features
    setTimeout(() => {
        updateLivePlayerCount();
        showRecentActivity();
        addUrgencyTimer();
        showSocialProof();
    }, 2000);
});

// Handle hash changes
window.addEventListener('hashchange', () => {
    routeOnLoad();
});
</script>
</body>
</html>